<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NGS Panel Level II Analysis Report</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <div class="container">
        <!-- PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
        <div class="report-controls">
            <button id="pdf-download-btn" class="pdf-btn">
                ğŸ“„ PDF ë‹¤ìš´ë¡œë“œ
            </button>
        </div>
        <!-- ë””ë²„ê·¸ ì •ë³´ (ê°œë°œ ì¤‘ì—ë§Œ ì‚¬ìš©) -->
        {% if debug %}
        <div class="debug-info">
            <h3>ë””ë²„ê·¸ ì •ë³´</h3>
            <pre>{{ report_data | tojson(indent=4) }}</pre>
        </div>
        {% endif %}

        <!-- Page 1: ê²€ì²´ì •ë³´ + ì¼ë¶€ ê²€ì‚¬ê²°ê³¼ + Other biomarkers + Footer -->
        <div class="a4-page page-1">
            <div class="page-border">
                <div style="position: relative; height: 100%;">
                    <div class="report-content">
                        <!-- ë³´ê³ ì„œ í—¤ë” -->
                        <div class="report-header">
                            <h1>NGS Panel Level II Analysis Report</h1>
                        </div>
                    
                        <!-- ê²€ì²´ ì •ë³´ -->
                        <div class="section">
                            <h2 class="section-title">â–£ ê²€ì²´ ì •ë³´</h2>
                            <table class="info-table full-width" border="1">
                                <tr>
                                    <th>ê²€ì²´ ì •ë³´</th>
                                    <th>ì„±ë³„</th>
                                    <th>ë‚˜ì´</th>
                                    <th>Unit NO.</th>
                                    <th>í™˜ìëª…</th>
                                    <th>ì±„ì·¨ ì¥ê¸°</th>
                                    <th>ì›ë°œ ì¥ê¸°</th>
                                    <th colspan="2">ì§„ë‹¨</th>
                                </tr>
                                <tr>
                                    <td>{{ report_data.clinical_info['ê²€ì²´ ì •ë³´'] }}</td>
                                    <td>{{ report_data.clinical_info.ì„±ë³„ }}</td>
                                    <td>{{ report_data.clinical_info.ë‚˜ì´ }}</td>
                                    <td>{{ report_data.clinical_info['Unit NO.'] }}</td>
                                    <td>{{ report_data.clinical_info.í™˜ìëª… }}</td>
                                    <td>{{ report_data.clinical_info['ì±„ì·¨ ì¥ê¸°'] }}</td>
                                    <td>{{ report_data.clinical_info['ì›ë°œ ì¥ê¸°'] }}</td>
                                    <td colspan="2">{{ report_data.clinical_info.ì§„ë‹¨ }}</td>
                                </tr>
                                <tr>
                                    <th>ì˜ë¢°ì˜</th>
                                    <th colspan="3" style="width: 20%;">ì˜ë¢°ì˜ ì†Œì†</th>
                                    <th>ê²€ì²´ ìœ í˜•</th>
                                    <th colspan="2">ê²€ì²´ì˜ ì ì ˆì„±ì—¬ë¶€</th>
                                    <th>ê²€ì²´ì ‘ìˆ˜ì¼</th>
                                    <th>ê²°ê³¼ë³´ê³ ì¼</th>
                                </tr>
                                <tr>
                                    <td>{{ report_data.clinical_info['ì˜ë¢°ì˜'] }}</td>
                                    <td colspan="3" style="width: 20%;">{{ report_data.clinical_info['ì˜ë¢°ì˜ ì†Œì†'] }}</td>
                                    <td>{{ report_data.clinical_info['ê²€ì²´ ìœ í˜•'] }}</td>
                                    <td colspan="2">{{ report_data.clinical_info['ê²€ì²´ì˜ ì ì ˆì„±ì—¬ë¶€'] }}</td>
                                    <td>{{ report_data.clinical_info['ê²€ì²´ì ‘ìˆ˜ì¼'] }}</td>
                                    <td>{{ report_data.clinical_info.get('ê²°ê³¼ë³´ê³ ì¼', 'N/A') }}</td>
                                </tr>
                            </table>
                        </div>
                        
                        <!-- ê²€ì‚¬ê²°ê³¼ -->
                        <div class="section">
                            <h2 class="section-title">â–£ ê²€ì‚¬ê²°ê³¼</h2>
                            
                            <!-- 1. Variants of clinical significance -->
                            <h3 class="result-title">1. Variants of clinical significance</h3>
                            
                            <!-- SNVs & Indels (ë¶„í•  ê°€ëŠ¥) -->
                            {% if report_data.snv_clinical.data %}
                            <div id="snv-clinical-section" class="splittable-section" data-section-name="SNVs & Indels" data-table-type="clinical">
                                <h4 class="variant-type snv-title">- SNVs & Indels{% if report_data.snv_clinical.highlight %}<span class="clinical-highlight">: {{ report_data.snv_clinical.highlight }}</span>{% endif %}</h4>
                            <table class="data-table full-width" border="1" id="snv-clinical-table">
                            <thead>
                                <tr>
                                    <th>GENE</th>
                                    <th>MUTATION TYPE</th>
                                    <th>AA CHANGE</th>
                                    <th>VAF (%)</th>
                                        <th>HGVSc</th>
                                        <th>HGVSp</th>
                                    </tr>
                            </thead>
                            <tbody>
                                {% for row in report_data.snv_clinical.data %}
                                    <tr class="snv-data-row">
                                        {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <h4 class="variant-type">- SNVs & Indels<span class="none-text">: None</span></h4>
            {% endif %}
                            
                            <!-- Fusion gene (ë¶„í•  ê°€ëŠ¥) -->
                            {% if report_data.fusion_clinical.data %}
                            <div id="fusion-clinical-section" class="splittable-section" data-section-name="Fusion gene" data-table-type="clinical">
                                <h4 class="variant-type fusion-title">- Fusion gene{% if report_data.fusion_clinical.highlight %}<span class="clinical-highlight">: {{ report_data.fusion_clinical.highlight }}</span>{% endif %}</h4>
                            <table class="data-table full-width" border="1" id="fusion-clinical-table">
                            <thead>
                                <tr>
                                    <th>GENE FUSION</th>
                                    <th>BREAKPOINT 1</th>
                                        <th>BREAKPOINT 2</th>
                                        <th>FUSION SUPPORTING READS</th>
                                    </tr>
                            </thead>
                            <tbody>
                                {% for row in report_data.fusion_clinical.data %}
                                    <tr class="fusion-data-row">
                                        {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <h4 class="variant-type">- Fusion gene<span class="none-text">: None</span></h4>
            {% endif %}
                            
                            <!-- Copy number variation (ë¶„í•  ê°€ëŠ¥) -->
                            {% if report_data.cnv_clinical.data %}
                            <div id="cnv-clinical-section" class="splittable-section" data-section-name="Copy number variation">
                                <h4 class="variant-type cnv-title">- Copy number variation{% if report_data.cnv_clinical.highlight %}<span class="clinical-highlight">: {{ report_data.cnv_clinical.highlight }}</span>{% endif %}</h4>
                            <table class="data-table full-width" border="1" id="cnv-clinical-table">
                            <thead>
                                <tr>
                                    <th>GENE</th>
                                    <th>LOCATION</th>
                                        <th>FOLD CHANGE</th>
                                        <th>ESTIMATED COPY NUMBER</th>
                                    </tr>
                            </thead>
                            <tbody>
                                {% for row in report_data.cnv_clinical.data %}
                                    <tr class="cnv-data-row">
                                        {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <h4 class="variant-type">- Copy number variation<span class="none-text">: None</span></h4>
            {% endif %}
                            
                            <!-- Large rearrangements in BRCA1/2 (ë¶„í•  ê°€ëŠ¥) -->
                            {% if report_data.lr_brca_clinical.data %}
                            <div id="lr-brca-clinical-section" class="splittable-section" data-section-name="Large rearrangements in BRCA1/2" data-table-type="clinical">
                                <h4 class="variant-type lr-brca-title">- Large rearrangements in BRCA1/2{% if report_data.lr_brca_clinical.highlight %}<span class="clinical-highlight">: {{ report_data.lr_brca_clinical.highlight }}</span>{% endif %}</h4>
                            <table class="data-table full-width" border="1" id="lr-brca-clinical-table">
                            <thead>
                                <tr>
                                    <th>GENE</th>
                                    <th>LOCATION</th>
                                    <th>AFFECTED EXON</th>
                                        <th>FOLD CHANGE</th>
                                        <th>ESTIMATED COPY NUMBER</th>
                                    </tr>
                            </thead>
                            <tbody>
                                {% for row in report_data.lr_brca_clinical.data %}
                                    <tr class="lr-brca-data-row">
                                        {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <h4 class="variant-type">- Large rearrangements in BRCA1/2<span class="none-text">: None</span></h4>
            {% endif %}
                            
                            <!-- Splice variant (ë¶„í•  ê°€ëŠ¥) -->
                            {% if report_data.splice_clinical.data %}
                            <div id="splice-clinical-section" class="splittable-section" data-section-name="Splice variant" data-table-type="clinical">
                                <h4 class="variant-type splice-title">- Splice variant{% if report_data.splice_clinical.highlight %}<span class="clinical-highlight">: {{ report_data.splice_clinical.highlight }}</span>{% endif %}</h4>
                            <table class="data-table full-width" border="1" id="splice-clinical-table">
                            <thead>
                                <tr>
                                    <th>GENE</th>
                                    <th>AFFECTED EXON</th>
                                    <th>BREAKPOINT 1</th>
                                        <th>BREAKPOINT 2</th>
                                        <th>SPLICE SUPPORTING READS</th>
                                    </tr>
                            </thead>
                            <tbody>
                                {% for row in report_data.splice_clinical.data %}
                                    <tr class="splice-data-row">
                                        {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <h4 class="variant-type">- Splice variant<span class="none-text">: None</span></h4>
            {% endif %}
                        </div>
                    </div>
                    
                    <!-- ì²« í˜ì´ì§€ í•˜ë‹¨ ê³ ì • ì»¨í…ì¸  -->
                    <div class="page-bottom-fixed">
                        <!-- Other Biomarkers -->
                        <div class="section">
                            <h4 class="variant-type">- Other Biomarkers</h4>
                            <table class="biomarkers-table full-width" border="1">
                                <tr>
                                    <th>Estimated Tumor Mutation Burden (TMB)</th>
                                    <th>Microsatellite Instability (MSI) (% Unstable MSI Sites)</th>
                                </tr>
                                <tr>
                                    <td>{{ report_data.biomarkers.TMB }}</td>
                                    <td>{{ report_data.biomarkers.MSI }}</td>
                                </tr>
                            </table>
                        </div>
                        
                        <!-- Footer (ë¡œê³ ì™€ ê²€ì‚¬ê¸°ê´€ ì •ë³´ë§Œ) -->
                        <div class="report-footer">
                            <div class="footer-container">
                                <div class="footer-row">
                                    <div class="footer-left">
                                        <div class="footer-org">ê²€ì‚¬ê¸°ê´€ : ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ ë¶„ìë³‘ë¦¬ ê²€ì‚¬ì‹¤</div>
                                        <div class="footer-address">ì„œìš¸ì‹œ ì„œëŒ€ë¬¸êµ¬ ì—°ì„¸ë¡œ 50-1 (ì‹ ì´Œë™ 134) ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ Tel: 02-2228-2625</div>
                                    </div>
                                    <div class="footer-right">
                                        <img src="/static/images/Sev_Logo.png" alt="ì„¸ë¸Œë€ìŠ¤ë³‘ì›">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Page 1-continued: ê²€ì‚¬ê²°ê³¼ ë‚˜ë¨¸ì§€ ë¶€ë¶„ -->
        <div class="a4-page page-continued page-continued-1">
            <div class="page-border">
                <div class="report-content">
                    <!-- 2. Variants of unknown significance -->
                    <h3 class="result-title">2. Variants of unknown significance</h3>
                    
                    <!-- SNVs & Indels -->
                    {% if report_data.snv_unknown.data %}
                    <h4 class="variant-type">- SNVs & Indels{% if report_data.snv_unknown.highlight %}: {{ report_data.snv_unknown.highlight }}{% endif %}</h4>
                    <table class="data-table full-width" border="1" id="snv-unknown-table">
                        <tr>
                            <th>GENE</th>
                            <th>MUTATION TYPE</th>
                            <th>AA CHANGE</th>
                            <th>VAF (%)</th>
                            <th>HGVSc</th>
                            <th>HGVSp</th>
                        </tr>
                        {% for row in report_data.snv_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- SNVs & Indels<span class="none-text">: None</span></h4>
                    {% endif %}
                    
                    <!-- Fusion gene -->
                    {% if report_data.fusion_unknown.data %}
                    <h4 class="variant-type">- Fusion gene{% if report_data.fusion_unknown.highlight %}: {{ report_data.fusion_unknown.highlight }}{% endif %}</h4>
                    <table class="data-table full-width" border="1" id="fusion-unknown-table">
                        <tr>
                            <th>GENE FUSION</th>
                            <th>BREAKPOINT 1</th>
                            <th>BREAKPOINT 2</th>
                            <th>FUSION SUPPORTING READS</th>
                        </tr>
                        {% for row in report_data.fusion_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- Fusion gene<span class="none-text">: None</span></h4>
                    {% endif %}
                    
                    <!-- Copy number variation -->
                    {% if report_data.cnv_unknown.data %}
                    <h4 class="variant-type">- Copy number variation{% if report_data.cnv_unknown.highlight %}: {{ report_data.cnv_unknown.highlight }}{% endif %}</h4>
                    <table class="data-table full-width" border="1" id="cnv-unknown-table">
                        <tr>
                            <th>GENE</th>
                            <th>LOCATION</th>
                            <th>FOLD CHANGE</th>
                            <th>ESTIMATED COPY NUMBER</th>
                        </tr>
                        {% for row in report_data.cnv_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- Copy number variation<span class="none-text">: None</span></h4>
                    {% endif %}
                    
                    <!-- Large rearrangements in BRCA1/2 -->
                    {% if report_data.lr_brca_unknown.data %}
                    <h4 class="variant-type">- Large rearrangements in BRCA1/2{% if report_data.lr_brca_unknown.highlight %}: {{ report_data.lr_brca_unknown.highlight }}{% endif %}</h4>
                    <table class="data-table full-width" border="1" id="lr-brca-unknown-table">
                        <tr>
                            <th>GENE</th>
                            <th>LOCATION</th>
                            <th>AFFECTED EXON</th>
                            <th>FOLD CHANGE</th>
                            <th>ESTIMATED COPY NUMBER</th>
                        </tr>
                        {% for row in report_data.lr_brca_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- Large rearrangements in BRCA1/2<span class="none-text">: None</span></h4>
                    {% endif %}
                    
                    <!-- Splice variant -->
                    {% if report_data.splice_unknown.data %}
                    <h4 class="variant-type">- Splice variant{% if report_data.splice_unknown.highlight %}: {{ report_data.splice_unknown.highlight }}{% endif %}</h4>
                    <table class="data-table full-width" border="1" id="splice-unknown-table">
                        <tr>
                            <th>GENE</th>
                            <th>AFFECTED EXON</th>
                            <th>BREAKPOINT 1</th>
                            <th>BREAKPOINT 2</th>
                            <th>SPLICE SUPPORTING READS</th>
                        </tr>
                        {% for row in report_data.splice_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- Splice variant<span class="none-text">: None</span></h4>
                    {% endif %}
                    
                    <!-- 3. Failed gene -->
                    <h3 class="result-title">3. Failed gene: <span id="failed-gene">{{ report_data.failed_gene }}</span></h3>
                    
                    <!-- Comment -->
                    <div class="section" style="margin-top: 20px;">
                        <h2 class="section-title">â–£ Comment</h2>
                        <div class="comment-section">
                            <div id="comments" class="comment-box">
                                {% if report_data.comments %}
                                    <div class="comment-text">
                                        {% for comment in report_data.comments %}
                                            <p>{{ comment }}</p>
                                            {% if not loop.last %}<br>{% endif %}
                                        {% endfor %}
                                    </div>
                                    <br>
                                {% endif %}
                                <p>ë³¸ ê°€ì´ë“œëŠ” í™˜ìì˜ ì•”ê³¼ ê´€ë ¨ëœ ë¶„ì ì´ìƒ(COSMIC Cancer e-Journals) íŒë‹¨ ê·¼ê±°ì™€ ì°¸ê³ ë¬¸í—Œì„ ì œê³µí•©ë‹ˆë‹¤. ASCO ê°€ì´ë“œë¼ì¸ì— ë”°ë¼ Strong Clinical Significance (Tier I), Unknown Clinical Significance (Tier II), Benign or Likely Benignì„ íŒë³„í•˜ì—¬ ìœ ì „ì ë³€ì´ì˜ ì„ìƒì  ì¤‘ìš”ë„ë¥¼ í‰ê°€í•˜ì˜€ìŠµë‹ˆë‹¤. Standards and Guidelines for the Interpretation and Reporting of Sequence Variants in Cancer: A Joint Consensus Recommendation of the Association for Molecular Pathology, American Society of Clinical Oncology, and College of American Pathologists. J Mol Diagn 2017; 19(1):4-23.</p>
                            </div>
                            
                            <!-- ì¶”ê°€ ì•ˆë‚´ì‚¬í•­ -->
                            <div class="additional-info">
                                <p>â€¢ ë³¸ ê²€ì‚¬ì˜ raw data (BAM, FASTQ, VCF) íŒŒì¼ì€ ë¶„ì ë³‘ë¦¬ ê²€ì‚¬ì‹¤ ë‚´ ë³‘ë¦¬ê³¼ ì„œë²„ ì»´í“¨í„°ì—ì„œ ë³´ê´€, ê´€ë¦¬ë˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
                                <p>â€¢ ë³¸ ê²€ì‚¬ì˜ ê²°ê³¼ëŠ” ê²€ì²´ì— í¬í•¨ëœ ì •ìƒì„¸í¬ì™€ ì•”ì„¸í¬ì˜ ë¹„ìœ¨ì— ë”°ë¼ ìœ„ìŒì„±ì˜ ê²°ê³¼ë¥¼ ë°°ì œ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Page 2: ê²€ì‚¬ì •ë³´ë¶€í„° Specificationê¹Œì§€ -->
        <div class="a4-page page-2">
            <div class="page-border">
                <div class="page-2-content" style="margin-top: 15px;">
                    <!-- ê²€ì‚¬ì •ë³´ -->
                    <div class="section">
                        <h2 class="section-title">â–£ ê²€ì‚¬ì •ë³´</h2>
                        <div class="info-section">
                            <p><span class="info-label">ê²€ì‚¬ì‹œì•½ :</span> {% if report_data.panel_type == 'GE' %}AllPrep DNA/RNA FFPE Kit (50) [Qiagen], TruSightâ„¢ Oncology 500 kit [Illumina]{% else %}AllPrep DNA/RNA FFPE Kit (50) [Qiagen], TruSightâ„¢ Oncology 500 kit [Illumina], TruSightâ„¢ RNA Fusion Panel [Illumina]{% endif %}</p>
                            <p><span class="info-label">ê²€ì‚¬ë°©ë²• :</span> NGS targeted DNA/RNA sequencing (Library : Hybrid capture)</p>
                            <p><span class="info-label">ê²€ì‚¬ê¸°ê¸° :</span> {{ report_data.diagnostic_info.ê²€ì‚¬ê¸°ê¸° }}</p>
                            <p><span class="info-label">Reference genome :</span> Homo_sapiens/ UCSC/ hg19</p>
                        </div>
                    </div>
                    
                    <!-- Filter history -->
                    <div class="section">
                        <h2 class="section-title">â–£ Filter history</h2>
                        <div class="info-section">
                            <p><span class="info-label">Include :</span> Exonic, Illumina Q.C Filter PASS, Fold change &lt;0.5 or &gt;1.5</p>
                            <p><span class="info-label">Exclude :</span> Synonymous, VAF &lt;3%, total depth &lt;100, refer depth=0</p>
                        </div>
                    </div>
                    
                    <!-- DNA, RNA -->
                    <div class="section">
                        <h2 class="section-title">â–£ DNA, RNA <span class="small-text">(Qubit ë†ë„)</span></h2>
                        <div class="info-section">
                            <p><span class="info-label">DNA (ng/ul) :</span> {{ report_data.drna_qubit.DNA }} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="info-label">RNA (ng/ul) :</span> {{ report_data.drna_qubit.RNA }}</p>
                        </div>
                    </div>
                    
                    <!-- Q.C -->
                    <div class="section">
                        <h2 class="section-title">â–£ Q.C</h2>
                        <div class="info-section">
                            <div class="qc-simple">
                                <div class="qc-header">
                                    <span class="qc-col-tight">Metric (UOM)</span>
                                    <span class="qc-col-tight">LSL Guideline</span>
                                    <span class="qc-col-tight">Value</span>
                                </div>
                                {% if report_data.qc.data %}
                                    {% for row in report_data.qc.data %}
                                        <div class="qc-row-simple">
                                            <span class="qc-col-tight">{{ row[0] }}</span>
                                            <span class="qc-col-tight">{{ row[1] }}</span>
                                            <span class="qc-col-tight">{{ row[2] }}</span>
                                        </div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Analysis Program -->
                    <div class="section">
                        <h2 class="section-title">â–£ Analysis Program</h2>
                        <div class="info-section">
                            <p>DRAGEN TSO500 ( Workflow Version : 2.5.2 )</p>
                        </div>
                    </div>
                    
                    <!-- Specification -->
                    <div class="section">
                        <h2 class="section-title">â–£ Specification</h2>
                        <div class="specification-box" id="specification-content">
                            <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Page 3: Gene Content -->
        {% if report_data.panel_type == 'GE' %}
        <!-- GE: í•œ í˜ì´ì§€ì— Gene Content + Footer -->
        <div class="a4-page page-3">
            <div class="page-border">
                <div class="page-3-content">
                    <div class="gene-content-wrapper" style="margin-top: 15px;">
                        <div class="section">
                            <h2 class="section-title">â–£ Gene Content in the TruSight Oncology 500 panel Assay</h2>
                            <div class="gene-content-box" id="ge-gene-content">
                                <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- ë§ˆì§€ë§‰ í˜ì´ì§€: ì‚¬ìš©ì ì •ë³´ + Footer -->
                    <div class="page-footer-wrapper">
                        <!-- ì‚¬ìš©ì ì •ë³´ (ë§ˆì§€ë§‰ í˜ì´ì§€ì—ë§Œ) -->
                        <div class="user-info-section">
                            <div class="user-info-divider"></div>
                            <div class="user-info-container">
                                <div class="user-info-number-row">
                                    <table class="user-number-table">
                                        <tr>
                                            <td class="user-number-label">ë¶„ì ì ‘ìˆ˜ ë²ˆí˜¸</td>
                                            <td class="user-number-value">{{ report_data.diagnosis_user['ë¶„ìì ‘ìˆ˜ë²ˆí˜¸'] }}</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="user-info-tested-row">
                                    <span class="user-tested"><strong>Tested by:</strong> {{ report_data.diagnosis_user['Tested by'] }}</span>
                                    <span class="user-analyzed"><strong>Analyzed by:</strong> {{ report_data.diagnosis_user['Analyzed by'] }}</span>
                                </div>
                                <div class="user-info-signed-row">
                                    <span class="user-signed"><strong>Signed by:</strong> {{ report_data.diagnosis_user['Signed by'] }}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Footer (ë¡œê³ ì™€ ê²€ì‚¬ê¸°ê´€ ì •ë³´ë§Œ) -->
                        <div class="report-footer">
                            <div class="footer-container">
                                <div class="footer-row">
                                    <div class="footer-left">
                                        <div class="footer-org">ê²€ì‚¬ê¸°ê´€ : ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ ë¶„ìë³‘ë¦¬ ê²€ì‚¬ì‹¤</div>
                                        <div class="footer-address">ì„œìš¸ì‹œ ì„œëŒ€ë¬¸êµ¬ ì—°ì„¸ë¡œ 50-1 (ì‹ ì´Œë™ 134) ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ Tel: 02-2228-2625</div>
                                    </div>
                                    <div class="footer-right">
                                        <img src="/static/images/Sev_Logo.png" alt="ì„¸ë¸Œë€ìŠ¤ë³‘ì›">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <!-- SA: DNA í˜ì´ì§€ -->
        <div class="a4-page page-3">
            <div class="page-border">
                <div class="page-3-content">
                    <div class="gene-content-wrapper" style="margin-top: 15px;">
                        <div class="section">
                            <h2 class="section-title">â–£ Gene Content in the NGS Sarcoma Panel Assay [DNA]</h2>
                            <div class="gene-content-box" id="sa-gene-content-dna">
                                <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- SA: RNA í˜ì´ì§€ + Footer -->
        <div class="a4-page page-4">
            <div class="page-border">
                <div class="page-4-content">
                    <div class="gene-content-wrapper" style="margin-top: 15px;">
                        <div class="section">
                            <h2 class="section-title">â–£ Gene Content in the NGS Sarcoma Panel Assay [RNA]</h2>
                            <div class="gene-content-box" id="sa-gene-content-rna">
                                <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- ë§ˆì§€ë§‰ í˜ì´ì§€: ì‚¬ìš©ì ì •ë³´ + Footer -->
                    <div class="page-footer-wrapper">
                        <!-- ì‚¬ìš©ì ì •ë³´ (ë§ˆì§€ë§‰ í˜ì´ì§€ì—ë§Œ) -->
                        <div class="user-info-section">
                            <div class="user-info-divider"></div>
                            <div class="user-info-container">
                                <div class="user-info-number-row">
                                    <table class="user-number-table">
                                        <tr>
                                            <td class="user-number-label">ë¶„ì ì ‘ìˆ˜ ë²ˆí˜¸</td>
                                            <td class="user-number-value">{{ report_data.diagnosis_user['ë¶„ìì ‘ìˆ˜ë²ˆí˜¸'] }}</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="user-info-tested-row">
                                    <span class="user-tested"><strong>Tested by:</strong> {{ report_data.diagnosis_user['Tested by'] }}</span>
                                    <span class="user-analyzed"><strong>Analyzed by:</strong> {{ report_data.diagnosis_user['Analyzed by'] }}</span>
                                </div>
                                <div class="user-info-signed-row">
                                    <span class="user-signed"><strong>Signed by:</strong> {{ report_data.diagnosis_user['Signed by'] }}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Footer (ë¡œê³ ì™€ ê²€ì‚¬ê¸°ê´€ ì •ë³´ë§Œ) -->
                        <div class="report-footer">
                            <div class="footer-container">
                                <div class="footer-row">
                                    <div class="footer-left">
                                        <div class="footer-org">ê²€ì‚¬ê¸°ê´€ : ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ ë¶„ìë³‘ë¦¬ ê²€ì‚¬ì‹¤</div>
                                        <div class="footer-address">ì„œìš¸ì‹œ ì„œëŒ€ë¬¸êµ¬ ì—°ì„¸ë¡œ 50-1 (ì‹ ì´Œë™ 134) ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ Tel: 02-2228-2625</div>
                                    </div>
                                    <div class="footer-right">
                                        <img src="/static/images/Sev_Logo.png" alt="ì„¸ë¸Œë€ìŠ¤ë³‘ì›">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- ë¶„í• ëœ CNV í…Œì´ë¸”ì„ ìœ„í•œ ì¶”ê°€ í˜ì´ì§€ (í•„ìš”ì‹œ ë™ì  ìƒì„±) -->
    <div class="a4-page page-cnv-continued" id="cnv-continued-page" style="display: none;">
        <div class="page-border">
            <div class="report-content">
                <!-- CNV ë¶„í•  í…Œì´ë¸” (2/2) -->
                <div id="cnv-continued-section">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                </div>
            </div>
            
            <!-- ì²« í˜ì´ì§€ í•˜ë‹¨ ê³ ì • ì»¨í…ì¸  ë³µì‚¬ -->
            <div class="page-bottom-fixed">
                <!-- Other Biomarkers -->
                <div class="section">
                    <h4 class="variant-type">- Other Biomarkers</h4>
                    <table class="biomarkers-table full-width" border="1">
                        <tr>
                            <th>Estimated Tumor Mutation Burden (TMB)</th>
                            <th>Microsatellite Instability (MSI) (% Unstable MSI Sites)</th>
                        </tr>
                        <tr>
                            <td>{{ report_data.biomarkers.TMB }}</td>
                            <td>{{ report_data.biomarkers.MSI }}</td>
                        </tr>
                    </table>
                </div>
                
                <!-- Footer (ë¡œê³ ì™€ ê²€ì‚¬ê¸°ê´€ ì •ë³´ë§Œ) -->
                <div class="report-footer">
                    <div class="footer-container">
                        <div class="footer-row">
                            <div class="footer-left">
                                <div class="footer-org">ê²€ì‚¬ê¸°ê´€ : ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ ë¶„ìë³‘ë¦¬ ê²€ì‚¬ì‹¤</div>
                                <div class="footer-address">ì„œìš¸ì‹œ ì„œëŒ€ë¬¸êµ¬ ì—°ì„¸ë¡œ 50-1 (ì‹ ì´Œë™ 134) ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ Tel: 02-2228-2625</div>
                            </div>
                            <div class="footer-right">
                                <img src="/static/images/Sev_Logo.png" alt="ì„¸ë¸Œë€ìŠ¤ë³‘ì›">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ê²€ì²´ IDì™€ íŒ¨ë„ íƒ€ì…ì„ JavaScriptë¡œ ì „ë‹¬
        window.specimenId = '{{ specimen_id }}';
        window.panelType = '{{ report_data.panel_type }}';
        
        // Specification ë™ì  ë¡œë“œ
        async function loadSpecification() {
            const specContainer = document.getElementById('specification-content');
            if (!specContainer || !window.panelType) return;
            
            try {
                const response = await fetch(`/api/specification/${window.panelType}`);
                if (response.ok) {
                    const html = await response.text();
                    specContainer.innerHTML = html;
                } else {
                    specContainer.innerHTML = '<p style="text-align: center; color: #999;">Specification ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } catch (error) {
                console.error('Specification ë¡œë“œ ì˜¤ë¥˜:', error);
                specContainer.innerHTML = '<p style="text-align: center; color: #999;">Specification ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }
        
        // Gene Content ë™ì  ë¡œë“œ
        async function loadGeneContent() {
            if (!window.panelType) return;
            
            if (window.panelType === 'GE') {
                await loadGEGeneContent();
            } else if (window.panelType === 'SA') {
                await loadSAGeneContent();
            }
        }
        
        // GE Gene Content ë¡œë“œ
        async function loadGEGeneContent() {
            const container = document.getElementById('ge-gene-content');
            if (!container) return;
            
            try {
                const response = await fetch('/api/gene-content/GE_Gene_Content_DRNA');
                if (response.ok) {
                    const html = await response.text();
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<p style="text-align: center; color: #999;">Gene Content ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } catch (error) {
                console.error('GE Gene Content ë¡œë“œ ì˜¤ë¥˜:', error);
                container.innerHTML = '<p style="text-align: center; color: #999;">Gene Content ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }
        
        // SA Gene Content ë¡œë“œ
        async function loadSAGeneContent() {
            const dnaContainer = document.getElementById('sa-gene-content-dna');
            const rnaContainer = document.getElementById('sa-gene-content-rna');
            
            // DNA Content ë¡œë“œ
            if (dnaContainer) {
                try {
                    const response = await fetch('/api/gene-content/SA_Gene_Content_DNA');
                    if (response.ok) {
                        const html = await response.text();
                        dnaContainer.innerHTML = html;
                    } else {
                        dnaContainer.innerHTML = '<p style="text-align: center; color: #999;">DNA Gene Content ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }
                } catch (error) {
                    console.error('SA DNA Gene Content ë¡œë“œ ì˜¤ë¥˜:', error);
                    dnaContainer.innerHTML = '<p style="text-align: center; color: #999;">DNA Gene Content ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
                }
            }
            
            // RNA Content ë¡œë“œ
            if (rnaContainer) {
                try {
                    const response = await fetch('/api/gene-content/SA_Gene_Content_RNA');
                    if (response.ok) {
                        const html = await response.text();
                        rnaContainer.innerHTML = html;
                    } else {
                        rnaContainer.innerHTML = '<p style="text-align: center; color: #999;">RNA Gene Content ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }
                } catch (error) {
                    console.error('SA RNA Gene Content ë¡œë“œ ì˜¤ë¥˜:', error);
                    rnaContainer.innerHTML = '<p style="text-align: center; color: #999;">RNA Gene Content ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
                }
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ Specificationê³¼ Gene Content ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            loadSpecification();
            loadGeneContent();
        });
        
        // ì •í™•í•œ DOM ìˆœì„œ ê¸°ë°˜ ì½˜í…ì¸  ë°°ì¹˜ ë° ë¶„í• 
        function checkAndSplitTables() {
            const page1Content = document.querySelector('.page-1 .report-content');
            const otherBiomarkers = document.querySelector('.page-bottom-fixed');
            
            // Other Biomarkersì˜ ìœ„ì¹˜
            const otherBiomarkersRect = otherBiomarkers.getBoundingClientRect();
            const otherBiomarkersTop = otherBiomarkersRect.top;
            
            console.log('Other Biomarkers top position:', otherBiomarkersTop);
            
            // ê²€ì‚¬ê²°ê³¼ ì„¹ì…˜ ì°¾ê¸°
            const allSections = document.querySelectorAll('.section');
            let resultSection = null;
            
            for (let section of allSections) {
                const h2 = section.querySelector('h2.section-title');
                if (h2 && h2.textContent.includes('ê²€ì‚¬ê²°ê³¼')) {
                    resultSection = section;
                    break;
                }
            }
            
            if (!resultSection) {
                console.log('Result section not found');
                return;
            }
            
            console.log('Found result section:', resultSection);
            
            // ê²€ì‚¬ê²°ê³¼ ì„¹ì…˜ ë‚´ì˜ ëª¨ë“  ìš”ì†Œë“¤ì„ ìˆœì„œëŒ€ë¡œ ê°€ì ¸ì˜¤ê¸°
            const allElements = Array.from(resultSection.children);
            
            console.log('Elements in result section:', allElements.length);
            
            let overflowElement = null;
            let overflowIndex = -1;
            
            // ê° ìš”ì†Œê°€ Other Biomarkersì™€ ê²©ì¹˜ëŠ”ì§€ ì²´í¬
            for (let i = 0; i < allElements.length; i++) {
                const element = allElements[i];
                const elementRect = element.getBoundingClientRect();
                
                const elementInfo = element.classList ? element.classList.toString() : element.tagName;
                console.log(`Element ${i} (${elementInfo}): bottom=${elementRect.bottom}, otherBiomarkersTop=${otherBiomarkersTop}`);
                
                if (elementRect.bottom > otherBiomarkersTop - 10) { // 10px ì—¬ìœ ê³µê°„
                    overflowElement = element;
                    overflowIndex = i;
                    console.log(`Found overflow at element ${i}:`, element);
                    break;
                }
            }
            
            if (overflowElement) {
                handleOverflowElement(overflowElement, allElements, overflowIndex);
            } else {
                console.log('No overflow detected');
            }
        }
        
        function handleOverflowElement(element, allElements, overflowIndex) {
            console.log('=== HANDLING OVERFLOW ELEMENT ===');
            console.log('Overflow element:', element);
            console.log('Element class:', element.className);
            console.log('Element tag:', element.tagName);
            console.log('Overflow index:', overflowIndex);
            console.log('Total elements in section:', allElements.length);
            
            // ì´ ìš”ì†Œë¶€í„° ëê¹Œì§€ì˜ ëª¨ë“  ìš”ì†Œë“¤ ë¡œê·¸
            console.log('Elements to be moved:');
            for (let i = overflowIndex; i < allElements.length; i++) {
                const elem = allElements[i];
                console.log(`  ${i}: ${elem.tagName} - ${elem.className}`);
            }
            
            // í…Œì´ë¸”ì´ ìˆëŠ” splittable-sectionì¸ì§€ í™•ì¸
            if (element.classList && element.classList.contains('splittable-section')) {
                const table = element.querySelector('table');
                const dataRows = table ? table.querySelectorAll('tbody tr') : [];
                
                console.log('Found splittable section with', dataRows.length, 'rows');
                
                // ë‚¨ì€ ê³µê°„ ê³„ì‚°
                const elementRect = element.getBoundingClientRect();
                const otherBiomarkers = document.querySelector('.page-bottom-fixed');
                const otherBiomarkersRect = otherBiomarkers.getBoundingClientRect();
                const availableSpace = otherBiomarkersRect.top - elementRect.top - 10;
                
                // í…Œì´ë¸” í–‰ë“¤ì˜ ì‹¤ì œ ê³µê°„ í™œìš©ë„ ê³„ì‚°
                const result = calculateOptimalSplit(table, availableSpace);
                
                if (result.canSplit && result.splitRowIndex > 0) {
                    // í…Œì´ë¸” ë¶„í• 
                    console.log('DECISION: Splitting table at row', result.splitRowIndex);
                    splitTableAndMoveRest(element, allElements, overflowIndex, result.splitRowIndex);
                } else if (dataRows.length > 3) {
                    // ê¸°ë³¸ ë¶„í•  (ë°˜ìœ¼ë¡œ)
                    console.log('DECISION: Default splitting table');
                    splitTableAndMoveRest(element, allElements, overflowIndex);
                } else {
                    // ì „ì²´ ì´ë™
                    console.log('DECISION: Moving entire content (too few rows)');
                    moveElementsFromIndex(allElements, overflowIndex);
                }
            } else {
                // ì¼ë°˜ ìš”ì†Œ - ì´ ìš”ì†Œë¶€í„° ëê¹Œì§€ ëª¨ë‘ ì´ë™
                console.log('DECISION: Moving content (not a splittable section)');
                moveElementsFromIndex(allElements, overflowIndex);
            }
        }
        
        function splitTableAndMoveRest(tableElement, allElements, overflowIndex, customSplitPoint = null) {
            const sectionName = tableElement.dataset.sectionName;
            const tableType = tableElement.dataset.tableType;
            const table = tableElement.querySelector('table');
            const dataRows = table.querySelectorAll('tbody tr');
            
            // ì»¤ìŠ¤í…€ ë¶„í• ì ì´ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ë°˜ìœ¼ë¡œ ë‚˜ëˆ„ê¸°
            const splitPoint = customSplitPoint || Math.ceil(dataRows.length / 2);
            
            console.log(`Splitting ${sectionName}: keeping ${splitPoint} rows, moving ${dataRows.length - splitPoint} rows`);
            
            // ì²« ë²ˆì§¸ í˜ì´ì§€ ì œëª©ì— (1/2) ì¶”ê°€
            const titleElement = tableElement.querySelector('.variant-type');
            if (titleElement && !titleElement.textContent.includes('(1/2)')) {
                const titleText = titleElement.innerHTML;
                titleElement.innerHTML = titleText.replace(`- ${sectionName}`, `- ${sectionName} (1/2)`);
            }
            
            // ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™í•  ëª¨ë“  ìš”ì†Œë“¤ ìˆ˜ì§‘
            const elementsToMove = allElements.slice(overflowIndex); // í˜„ì¬ ìš”ì†Œë¶€í„° ëê¹Œì§€
            
            // ë¶„í• ëœ í…Œì´ë¸”ê³¼ ë‚˜ë¨¸ì§€ ìš”ì†Œë“¤ë¡œ ìƒˆ í˜ì´ì§€ ìƒì„±
            createSplitPage(tableElement, dataRows, splitPoint, sectionName, tableType, elementsToMove.slice(1));
            
            // ì²« ë²ˆì§¸ í˜ì´ì§€ì—ì„œ ì´ˆê³¼ í–‰ë“¤ ì œê±°
            for (let i = splitPoint; i < dataRows.length; i++) {
                dataRows[i].remove();
            }
            
            // ì›ë³¸ í˜ì´ì§€ì—ì„œ ì´ë™ëœ ìš”ì†Œë“¤ ì œê±°
            elementsToMove.slice(1).forEach(element => {
                if (element.parentNode) {
                    element.parentNode.removeChild(element);
                }
            });
        }
        
        function moveContentToNewPage(sections) {
            // ìƒˆë¡œìš´ í˜ì´ì§€ ìƒì„±
            const page1 = document.querySelector('.page-1');
            const continuedPage = document.createElement('div');
            continuedPage.className = 'a4-page page-content-continued';
            
            // ì„¹ì…˜ë“¤ì˜ HTML ì¶”ì¶œ - ëª¨ë“  í´ë˜ìŠ¤ì™€ ì†ì„± ìœ ì§€
            let sectionsHTML = '';
            sections.forEach(section => {
                sectionsHTML += section.outerHTML;
                if (section.parentNode) {
                    section.parentNode.removeChild(section);
                }
            });
            
            continuedPage.innerHTML = `
                <div class="page-border">
                    <div class="report-content">
                        ${sectionsHTML}
                    </div>
                </div>
            `;
            
            // ì²« ë²ˆì§¸ í˜ì´ì§€ ë‹¤ìŒì— ì‚½ì…
            page1.parentNode.insertBefore(continuedPage, page1.nextSibling);
            
            console.log('Moved content to new page');
        }
        
        function moveElementsFromIndex(allElements, startIndex) {
            const elementsToMove = allElements.slice(startIndex);
            
            console.log(`Moving ${elementsToMove.length} elements from index ${startIndex}`);
            
            moveContentToNewPage(elementsToMove);
        }
        
        function createSplitPage(originalTableElement, allRows, splitPoint, sectionName, tableType, otherElements) {
            const page1 = document.querySelector('.page-1');
            
            // ë¶„í• ëœ í…Œì´ë¸” HTML ìƒì„±
            const splitTableHTML = createSplitTableHTML(originalTableElement, allRows, splitPoint, sectionName, tableType);
            
            // ë‚˜ë¨¸ì§€ ìš”ì†Œë“¤ HTML ìƒì„±  
            let otherElementsHTML = '';
            otherElements.forEach(element => {
                // ë‹¤ë¥¸ ìš”ì†Œë“¤ë„ ê·¸ëŒ€ë¡œ ë³µì‚¬
                otherElementsHTML += element.outerHTML;
            });
            
            // ìƒˆë¡œìš´ í˜ì´ì§€ ìƒì„±
            const continuedPage = document.createElement('div');
            continuedPage.className = 'a4-page page-content-continued';
            
            continuedPage.innerHTML = `
                <div class="page-border">
                    <div class="report-content">
                        ${splitTableHTML}
                        ${otherElementsHTML}
                    </div>
                </div>
            `;
            
            // ì²« ë²ˆì§¸ í˜ì´ì§€ ë‹¤ìŒì— ì‚½ì…
            page1.parentNode.insertBefore(continuedPage, page1.nextSibling);
            
            console.log(`Split page created for ${sectionName}`);
        }
        
        function createSplitTableHTML(originalSection, allRows, splitPoint, sectionName, tableType) {
            // ì›ë³¸ ì œëª©ì—ì„œ highlight ì •ë³´ ì¶”ì¶œ
            const originalTitle = originalSection.querySelector('.variant-type');
            const highlightElement = originalTitle ? originalTitle.querySelector('.clinical-highlight') : null;
            const highlightText = highlightElement ? highlightElement.outerHTML : '';
            
            // ì›ë³¸ ì œëª©ì˜ ëª¨ë“  í´ë˜ìŠ¤ë“¤ì„ ê°€ì ¸ì˜¤ê¸°
            let titleClasses = 'variant-type';
            if (originalTitle) {
                // ì›ë³¸ ì œëª©ì˜ ëª¨ë“  í´ë˜ìŠ¤ë¥¼ ê·¸ëŒ€ë¡œ ë³µì‚¬
                titleClasses = originalTitle.className;
            }
            
            // í…Œì´ë¸” í—¤ë” ì¶”ì¶œ
            const originalTable = originalSection.querySelector('table');
            const originalHeader = originalTable.querySelector('thead tr');
            let headerHTML = '';
            if (originalHeader) {
                headerHTML = originalHeader.innerHTML;
            }
            
            // ë‚˜ë¨¸ì§€ í–‰ë“¤ HTML ìƒì„±
            let rowsHTML = '';
            for (let i = splitPoint; i < allRows.length; i++) {
                rowsHTML += allRows[i].outerHTML;
            }
            
            return `
                <div class="continued-section">
                    <h4 class="${titleClasses}">- ${sectionName} (2/2)${highlightText}</h4>
                    <table class="data-table full-width split-table-continued ${tableType}-split" border="1">
                        <thead>
                            <tr>${headerHTML}</tr>
                        </thead>
                        <tbody>
                            ${rowsHTML}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        // ìµœì í™”ëœ í…Œì´ë¸” ë¶„í•  ìœ„ì¹˜ ê³„ì‚°
        function calculateOptimalSplit(table, availableSpace) {
            if (!table) return { canSplit: false };
            
            const thead = table.querySelector('thead');
            const tbody = table.querySelector('tbody');
            const rows = tbody ? tbody.querySelectorAll('tr') : [];
            
            if (rows.length <= 1) return { canSplit: false };
            
            // í—¤ë” ë†’ì´ ê³„ì‚°
            const headerHeight = thead ? thead.offsetHeight : 0;
            let currentHeight = headerHeight;
            
            // ê° í–‰ì˜ ë†’ì´ë¥¼ ê³„ì‚°í•˜ë©´ì„œ ìµœì  ë¶„í• ì  ì°¾ê¸°
            for (let i = 0; i < rows.length; i++) {
                const rowHeight = rows[i].offsetHeight;
                currentHeight += rowHeight;
                
                // í˜„ì¬ ë†’ì´ê°€ ì‚¬ìš© ê°€ëŠ¥í•œ ê³µê°„ì„ ì´ˆê³¼í•˜ë©´
                if (currentHeight > availableSpace) {
                    // ìµœì†Œ 1ê°œ í–‰ì€ ì²« í˜ì´ì§€ì— ë‚¨ê²¨ì•¼ í•¨
                    if (i > 0) {
                        return { canSplit: true, splitRowIndex: i };
                    } else {
                        return { canSplit: false };
                    }
                }
            }
            
            // ëª¨ë“  í–‰ì´ ë“¤ì–´ê°€ë©´ ë¶„í•  ë¶ˆí•„ìš”
            return { canSplit: false };
        }
        
        // í˜ì´ì§€ ë¡œë“œ í›„ í…Œì´ë¸” ë¶„í•  ì²´í¬
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded');
            // ì¶©ë¶„í•œ ì§€ì—°ì„ ë‘ì–´ ë ˆì´ì•„ì›ƒì´ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹¤í–‰
            setTimeout(() => {
                console.log('Starting table split check after delay');
                checkAndSplitTables();
            }, 1000); // 1ì´ˆ ì§€ì—°
        });
        
        // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì‹œì—ë„ ì²´í¬
        window.addEventListener('resize', function() {
            console.log('Window resized');
            setTimeout(checkAndSplitTables, 500);
        });
        
        // ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ í›„ì—ë„ ì²´í¬
        window.addEventListener('load', function() {
            console.log('Window fully loaded');
            setTimeout(() => {
                console.log('Final table split check after full load');
                checkAndSplitTables();
            }, 1500); // 1.5ì´ˆ ì§€ì—°
        });
    </script>
    <script src="/static/js/script.js"></script>
    
    <!-- PDF ë‹¤ìš´ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸ -->
    <!-- <script src="/static/js/report.js"></script> -->
</body>
</html>
