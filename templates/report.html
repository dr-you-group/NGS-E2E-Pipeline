<!DOCTYPE html>
<html lang="ko">
{% macro render_highlight(highlight_data) %}
{% if highlight_data %}
:
{% for segment in highlight_data %}
{% if segment.style == 'italic' %}
<i>{{ segment.text }}</i>
{% else %}
{{ segment.text }}
{% endif %}
{% endfor %}
{% endif %}
{% endmacro %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NGS Report</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <!-- Critical CSS for Loading Overlay -->
    <style>
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #ffffff;
            z-index: 99999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #333;
            /* Dark grey for professional look */
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        .loading-text {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 16px;
            color: #333;
            font-weight: 500;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        body.loaded #loading-overlay {
            opacity: 0;
            visibility: hidden;
        }
    </style>
    <link rel="stylesheet" href="/static/css/styles.css?v=30">
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± Ï§ë...</div>
    </div>
    <div class="container">
        <!-- PDF Îã§Ïö¥Î°úÎìú Î≤ÑÌäº -->
        <div class="report-controls">
            <button id="pdf-download-btn" class="report-btn pdf">
                üìÑ PDF Îã§Ïö¥Î°úÎìú
            </button>
            <button id="ppt-download-btn" class="report-btn ppt" onclick="downloadPPT('{{ specimen_id }}')">
                üìë PPT Îã§Ïö¥Î°úÎìú
            </button>
        </div>
        <!-- ÎîîÎ≤ÑÍ∑∏ Ï†ïÎ≥¥ (Í∞úÎ∞ú Ï§ëÏóêÎßå ÏÇ¨Ïö©) -->
        {% if debug %}
        <div class="debug-info">
            <h3>ÎîîÎ≤ÑÍ∑∏ Ï†ïÎ≥¥</h3>
            <pre>{{ report_data | tojson(indent=4) }}</pre>
        </div>
        {% endif %}

        <!-- Page 1: Í≤ÄÏ≤¥Ï†ïÎ≥¥ + ÏùºÎ∂Ä Í≤ÄÏÇ¨Í≤∞Í≥º + Other biomarkers + Footer -->
        <div class="a4-page page-1">
            <div class="page-border">
                <div style="position: relative; height: 100%;">
                    <div class="report-content">
                        <!-- Î≥¥Í≥†ÏÑú Ìó§Îçî -->
                        <div class="report-header">
                            <h1>NGS Panel Level II Analysis Report</h1>
                        </div>

                        <!-- Í≤ÄÏ≤¥ Ï†ïÎ≥¥ -->
                        <div class="section">
                            <h2 class="section-title">‚ñ£ Í≤ÄÏ≤¥ Ï†ïÎ≥¥</h2>
                            <table class="info-table full-width">
                                <tr>
                                    <th>Í≤ÄÏ≤¥ Ï†ïÎ≥¥</th>
                                    <th>ÏÑ±Î≥Ñ</th>
                                    <th>ÎÇòÏù¥</th>
                                    <th>Unit NO.</th>
                                    <th>ÌôòÏûêÎ™Ö</th>
                                    <th>Ï±ÑÏ∑® Ïû•Í∏∞</th>
                                    <th>ÏõêÎ∞ú Ïû•Í∏∞</th>
                                    <th colspan="2">ÏßÑÎã®</th>
                                </tr>
                                <tr>
                                    <td>{{ report_data.clinical_info['Í≤ÄÏ≤¥ Ï†ïÎ≥¥'] }}</td>
                                    <td>{{ report_data.clinical_info.ÏÑ±Î≥Ñ }}</td>
                                    <td>{{ report_data.clinical_info.ÎÇòÏù¥ }}</td>
                                    <td>{{ report_data.clinical_info['Unit NO.'] }}</td>
                                    <td>{{ report_data.clinical_info.ÌôòÏûêÎ™Ö }}</td>
                                    <td>{{ report_data.clinical_info['Ï±ÑÏ∑® Ïû•Í∏∞'] }}</td>
                                    <td>{{ report_data.clinical_info['ÏõêÎ∞ú Ïû•Í∏∞'] }}</td>
                                    <td colspan="2">{{ report_data.clinical_info.ÏßÑÎã® }}</td>
                                </tr>
                                <tr>
                                    <th>ÏùòÎ¢∞Ïùò</th>
                                    <th colspan="3" style="width: 20%;">ÏùòÎ¢∞Ïùò ÏÜåÏÜç</th>
                                    <th>Í≤ÄÏ≤¥ Ïú†Ìòï</th>
                                    <th colspan="2">Í≤ÄÏ≤¥Ïùò Ï†ÅÏ†àÏÑ±Ïó¨Î∂Ä</th>
                                    <th>Í≤ÄÏ≤¥Ï†ëÏàòÏùº</th>
                                    <th>Í≤∞Í≥ºÎ≥¥Í≥†Ïùº</th>
                                </tr>
                                <tr>
                                    <td>{{ report_data.clinical_info['ÏùòÎ¢∞Ïùò'] }}</td>
                                    <td colspan="3" style="width: 20%;">{{ report_data.clinical_info['ÏùòÎ¢∞Ïùò ÏÜåÏÜç'] }}</td>
                                    <td>{{ report_data.clinical_info['Í≤ÄÏ≤¥ Ïú†Ìòï'] }}</td>
                                    <td colspan="2">{{ report_data.clinical_info['Í≤ÄÏ≤¥Ïùò Ï†ÅÏ†àÏÑ±Ïó¨Î∂Ä'] }}</td>
                                    <td>{{ report_data.clinical_info['Í≤ÄÏ≤¥Ï†ëÏàòÏùº'] }}</td>
                                    <td>{{ report_data.clinical_info.get('Í≤∞Í≥ºÎ≥¥Í≥†Ïùº', 'N/A') }}</td>
                                </tr>
                            </table>
                        </div>

                        <!-- Í≤ÄÏÇ¨Í≤∞Í≥º -->
                        <div class="section">
                            <h2 class="section-title">‚ñ£ Í≤ÄÏÇ¨Í≤∞Í≥º</h2>

                            <!-- 1. Variants of clinical significance -->
                            <h3 class="result-title">1. <span class="clinical-highlight">Variants of clinical
                                    significance</span></h3>

                            <!-- SNVs & Indels (Î∂ÑÌï† Í∞ÄÎä•) -->
                            {% if report_data.snv_clinical.data %}
                            <div id="snv-clinical-section" class="splittable-section" data-section-name="SNVs & Indels"
                                data-table-type="clinical" {% if report_data.snv_clinical.split_at %}
                                data-split-at="{{ report_data.snv_clinical.split_at }}" {% endif %}>
                                <h4 class="variant-type snv-title">- SNVs & Indels
                                    <span class="clinical-highlight">
                                        {{ render_highlight(report_data.snv_clinical.highlight) }}
                                    </span>
                                </h4>
                                <table class="data-table full-width" id="snv-clinical-table">
                                    <thead>
                                        <tr>
                                            <th>GENE</th>
                                            <th>MUTATION TYPE</th>
                                            <th>AA CHANGE</th>
                                            <th>VAF (%)</th>
                                            <th>HGVSc</th>
                                            <th>HGVSp</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in report_data.snv_clinical.data %}
                                        <tr class="snv-data-row">
                                            {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <h4 class="variant-type">- SNVs & Indels<span class="none-text">: None</span></h4>
                            {% endif %}

                            <!-- Fusion gene (Î∂ÑÌï† Í∞ÄÎä•) -->
                            {% if report_data.fusion_clinical.data %}
                            <div id="fusion-clinical-section" class="splittable-section" data-section-name="Fusion gene"
                                data-table-type="clinical">
                                <h4 class="variant-type fusion-title">- Fusion genes
                                    <span class="clinical-highlight">
                                        {{ render_highlight(report_data.fusion_clinical.highlight) }}
                                    </span>
                                </h4>
                                <table class="data-table full-width" id="fusion-clinical-table">
                                    <thead>
                                        <tr>
                                            <th>GENE FUSION</th>
                                            <th>BREAKPOINT 1</th>
                                            <th>BREAKPOINT 2</th>
                                            <th>FUSION SUPPORTING READS</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in report_data.fusion_clinical.data %}
                                        <tr class="fusion-data-row">
                                            {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <h4 class="variant-type">- Fusion gene<span class="none-text">: None</span></h4>
                            {% endif %}

                            <!-- Copy number variation (Î∂ÑÌï† Í∞ÄÎä•) -->
                            {% if report_data.cnv_clinical.data %}
                            <div id="cnv-clinical-section" class="splittable-section"
                                data-section-name="Copy number variation" {% if report_data.cnv_clinical.split_at %}
                                data-split-at="{{ report_data.cnv_clinical.split_at }}" {% endif %}>
                                <h4 class="variant-type cnv-title">- Copy number variation
                                    <span class="clinical-highlight">
                                        {{ render_highlight(report_data.cnv_clinical.highlight) }}
                                    </span>
                                </h4>
                                <table class="data-table full-width" id="cnv-clinical-table">
                                    <thead>
                                        <tr>
                                            <th>GENE</th>
                                            <th>LOCATION</th>
                                            <th>FOLD CHANGE</th>
                                            <th>ESTIMATED COPY NUMBER</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in report_data.cnv_clinical.data %}
                                        <tr class="cnv-data-row">
                                            {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <h4 class="variant-type">- Copy number variation<span class="none-text">: None</span></h4>
                            {% endif %}

                            <!-- Large rearrangements in BRCA1/2 (Î∂ÑÌï† Í∞ÄÎä•) -->
                            {% if report_data.lr_brca_clinical.data %}
                            <div id="lr-brca-clinical-section" class="splittable-section"
                                data-section-name="Large rearrangements in BRCA1/2" data-table-type="clinical">
                                <h4 class="variant-type lr-brca-title">- Large rearrangements in BRCA1/2
                                    <span class="clinical-highlight">
                                        {{ render_highlight(report_data.lr_brca_clinical.highlight) }}
                                    </span>
                                </h4>
                                <table class="data-table full-width" id="lr-brca-clinical-table">
                                    <thead>
                                        <tr>
                                            <th>GENE</th>
                                            <th>LOCATION</th>
                                            <th>AFFECTED EXON</th>
                                            <th>FOLD CHANGE</th>
                                            <th>ESTIMATED COPY NUMBER</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in report_data.lr_brca_clinical.data %}
                                        <tr class="lr-brca-data-row">
                                            {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <h4 class="variant-type">- Large rearrangements in BRCA1/2<span class="none-text">:
                                    None</span></h4>
                            {% endif %}

                            <!-- Splice variant (Î∂ÑÌï† Í∞ÄÎä•) -->
                            {% if report_data.splice_clinical.data %}
                            <div id="splice-clinical-section" class="splittable-section"
                                data-section-name="Splice variant" data-table-type="clinical">
                                <h4 class="variant-type splice-title">- Splice variant
                                    <span class="clinical-highlight">
                                        {{ render_highlight(report_data.splice_clinical.highlight) }}
                                    </span>
                                </h4>
                                <table class="data-table full-width" id="splice-clinical-table">
                                    <thead>
                                        <tr>
                                            <th>GENE</th>
                                            <th>AFFECTED EXON</th>
                                            <th>BREAKPOINT 1</th>
                                            <th>BREAKPOINT 2</th>
                                            <th>SPLICE SUPPORTING READS</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in report_data.splice_clinical.data %}
                                        <tr class="splice-data-row">
                                            {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <h4 class="variant-type">- Splice variant<span class="none-text">: None</span></h4>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Ï≤´ ÌéòÏù¥ÏßÄ ÌïòÎã® Í≥†Ï†ï Ïª®ÌÖêÏ∏† -->
                    <div class="page-bottom-fixed">
                        <!-- Other Biomarkers -->
                        <!-- 5. Other Biomarkers -->
                        <div class="section">
                            {% set tmb_status = report_data.biomarkers.TMB.status | lower if
                            report_data.biomarkers.TMB.status else '' %}
                            {% set msi_status = report_data.biomarkers.MSI.status | lower if
                            report_data.biomarkers.MSI.status else '' %}
                            {% set is_tmb_high = 'high' in tmb_status %}
                            {% set is_msi_high = 'high' in msi_status %}

                            <h4 class="variant-type">- Other Biomarkers
                                {% if is_tmb_high and is_msi_high %}
                                <span class="clinical-highlight">: TMB-High and MSI-High</span>
                                {% elif is_tmb_high %}
                                <span class="clinical-highlight">: TMB-High</span>
                                {% elif is_msi_high %}
                                <span class="clinical-highlight">: MSI-High</span>
                                {% endif %}
                            </h4>
                            <table class="biomarkers-table full-width">
                                <thead>
                                    <tr>
                                        <th>Tumor Mutational Burden (TMB)</th>
                                        <th>Microsatellite Instability (MSI)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="{% if is_tmb_high %}clinical-highlight{% endif %}">{{
                                                report_data.biomarkers.TMB.value }}</span> {{
                                            report_data.biomarkers.TMB.unit }}</td>
                                        <td><span class="{% if is_msi_high %}clinical-highlight{% endif %}">{{
                                                report_data.biomarkers.MSI.value }}</span> {{
                                            report_data.biomarkers.MSI.unit }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Footer (Î°úÍ≥†ÏôÄ Í≤ÄÏÇ¨Í∏∞Í¥Ä Ï†ïÎ≥¥Îßå) -->
                        <div class="report-footer">
                            <div class="footer-container">
                                <div class="footer-row">
                                    <div class="footer-left">
                                        <div class="footer-org">Í≤ÄÏÇ¨Í∏∞Í¥Ä : ÏÑ∏Î∏åÎûÄÏä§Î≥ëÏõê Î≥ëÎ¶¨Í≥º Î∂ÑÏûêÎ≥ëÎ¶¨ Í≤ÄÏÇ¨Ïã§</div>
                                        <div class="footer-address">ÏÑúÏö∏Ïãú ÏÑúÎåÄÎ¨∏Íµ¨ Ïó∞ÏÑ∏Î°ú 50-1 (Ïã†Ï¥åÎèô 134) ÏÑ∏Î∏åÎûÄÏä§Î≥ëÏõê Î≥ëÎ¶¨Í≥º Tel:
                                            02-2228-2625
                                        </div>
                                    </div>
                                    <div class="footer-right">
                                        <img src="/static/images/Sev_Logo.png" alt="ÏÑ∏Î∏åÎûÄÏä§Î≥ëÏõê">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page 1-continued: Í≤ÄÏÇ¨Í≤∞Í≥º ÎÇòÎ®∏ÏßÄ Î∂ÄÎ∂Ñ -->
        <div class="a4-page page-continued page-continued-1">
            <div class="page-border">
                <div class="report-content">
                    <!-- 2. Variants of unknown significance -->
                    <h3 class="result-title">2. Variants of unknown significance</h3>

                    <!-- SNVs & Indels -->
                    {% if report_data.snv_unknown.data %}
                    <h4 class="variant-type">- SNVs & Indels{% if report_data.snv_unknown.highlight %}:
                        {{ report_data.snv_unknown.highlight | safe }}
                        {% endif %}
                    </h4>
                    <table class="data-table full-width" id="snv-unknown-table">
                        <tr>
                            <th>GENE</th>
                            <th>MUTATION TYPE</th>
                            <th>AA CHANGE</th>
                            <th>VAF (%)</th>
                            <th>HGVSc</th>
                            <th>HGVSp</th>
                        </tr>
                        {% for row in report_data.snv_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- SNVs & Indels: <span class="none-text">None</span></h4>
                    {% endif %}

                    <!-- Fusion gene -->
                    {% if report_data.fusion_unknown.data %}
                    <h4 class="variant-type">- Fusion gene{% if report_data.fusion_unknown.highlight %}:
                        {{ report_data.fusion_unknown.highlight | safe }}
                        {% endif %}
                    </h4>
                    <table class="data-table full-width" id="fusion-unknown-table">
                        <tr>
                            <th>GENE FUSION</th>
                            <th>BREAKPOINT 1</th>
                            <th>BREAKPOINT 2</th>
                            <th>FUSION SUPPORTING READS</th>
                        </tr>
                        {% for row in report_data.fusion_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- Fusion gene: <span class="none-text">None</span></h4>
                    {% endif %}

                    <!-- Copy number variation -->
                    {% if report_data.cnv_unknown.data %}
                    <h4 class="variant-type">- Copy number variation{% if report_data.cnv_unknown.highlight %}:
                        {{ report_data.cnv_unknown.highlight }}{% endif %}</h4>
                    <table class="data-table full-width" id="cnv-unknown-table">
                        <tr>
                            <th>GENE</th>
                            <th>LOCATION</th>
                            <th>FOLD CHANGE</th>
                            <th>ESTIMATED COPY NUMBER</th>
                        </tr>
                        {% for row in report_data.cnv_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- Copy number variation<span class="none-text">: None</span></h4>
                    {% endif %}

                    <!-- Large rearrangements in BRCA1/2 -->
                    {% if report_data.lr_brca_unknown.data %}
                    <h4 class="variant-type">- Large rearrangements in BRCA1/2
                        {% if report_data.lr_brca_unknown.highlight %}:
                        {{ report_data.lr_brca_unknown.highlight }}{% endif %}</h4>
                    <table class="data-table full-width" id="lr-brca-unknown-table">
                        <tr>
                            <th>GENE</th>
                            <th>LOCATION</th>
                            <th>AFFECTED EXON</th>
                            <th>FOLD CHANGE</th>
                            <th>ESTIMATED COPY NUMBER</th>
                        </tr>
                        {% for row in report_data.lr_brca_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- Large rearrangements in BRCA1/2<span class="none-text">: None</span></h4>
                    {% endif %}

                    <!-- Splice variant -->
                    {% if report_data.splice_unknown.data %}
                    <h4 class="variant-type">- Splice variant{% if report_data.splice_unknown.highlight %}:
                        {{ report_data.splice_unknown.highlight }}{% endif %}</h4>
                    <table class="data-table full-width" id="splice-unknown-table">
                        <tr>
                            <th>GENE</th>
                            <th>AFFECTED EXON</th>
                            <th>BREAKPOINT 1</th>
                            <th>BREAKPOINT 2</th>
                            <th>SPLICE SUPPORTING READS</th>
                        </tr>
                        {% for row in report_data.splice_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- Splice variant<span class="none-text">: None</span></h4>
                    {% endif %}

                    <!-- 3. Failed gene -->
                    <h3 class="result-title" style="margin-top: 9px;">3. Failed gene: <span id="failed-gene">{{
                            report_data.failed_gene }}</span>
                    </h3>

                    <!-- Comment -->
                    <div class="section" style="margin-top: 15px;">
                        <h2 class="section-title">‚ñ£ Comment</h2>
                        <div id="comments" class="comment-box">
                            {% if report_data.comments %}
                            <div class="comment-text">
                                {% for comment in report_data.comments %}
                                <p>{{ comment }}</p>
                                {% if not loop.last %}<br>{% endif %}
                                {% endfor %}
                            </div>
                            <br>
                            {% endif %}
                            <p>*Î≥∏ Í∏∞Í¥ÄÏùò Ïú†Ï†ÑÏûê Ï†ïÎ≥¥ Í≤ÄÏÉâ Î∞è Ìï¥ÏÑùÏùÄ dbSNP, COSMIC, ClinVar, c-bioportal Îì±Ïùò Ïú†Ï†ÑÏûê Ï†ïÎ≥¥Í≤ÄÏÉâ ÏÇ¨Ïù¥Ìä∏Î•º Ï∞∏Í≥†Î°ú ÌïòÍ≥† ÏûàÏäµÎãàÎã§.
                                ÎòêÌïú, Î∞úÍ≤¨Îêú Ïú†Ï†ÑÏûê Î≥ÄÏù¥Ïùò ÏûÑÏÉÅÏ†Å ÏùòÎØ∏Ïóê ÎåÄÌïòÏó¨, ÏïÑÎûò Ï∞∏Í≥† Î¨∏ÌóåÏóê Í∏∞Î∞òÌïú 4Îã®Í≥Ñ ÏãúÏä§ÌÖú (Tier I: Strong clinical
                                significance, Tier II: Potential Clinical significance, Tier III: Unknown Clinical
                                significance, Tier IV: Benign or Likely Benign) ÏùÑ Ï†ÅÏö©ÌïòÏó¨ Î≥¥Í≥†ÌïòÍ≥† ÏûàÏäµÎãàÎã§. ÎòêÌïú normal cell
                                sequencingÏù¥ Ïù¥Î£®Ïñ¥ÏßÄÏßÄ ÏïäÏïÑ ÏùºÎ∂Ä Î≥ÄÏù¥Ïùò Í≤ΩÏö∞ germline polymorphismÏùò Í∞ÄÎä•ÏÑ±ÏùÑ Î∞∞Ï†úÌï† Ïàò ÏóÜÏäµÎãàÎã§.<br>Standards and
                                Guidelines for the Interpretation and Reporting of Sequence Variants in Cancer. A Joint
                                Consensus Recommendation of the Association for Molecular Pathology, American Society of
                                Clinical Oncology and College of American Pathologists. J Mol Diagn. 2017; 19(1):4-23.
                            </p>
                        </div>
                    </div>

                    <!-- Ï∂îÍ∞Ä ÏïàÎÇ¥ÏÇ¨Ìï≠ (ÌéòÏù¥ÏßÄ ÌïòÎã® Í≥†Ï†ï) -->
                    <div class="additional-info" style="margin-top: auto; padding-bottom: 5px;">
                        <p>‚Ä¢ Î≥∏ Í≤ÄÏÇ¨Ïùò raw data (BAM, FASTQ, VCF) ÌååÏùºÏùÄ Î∂ÑÏûê Î≥ëÎ¶¨ Í≤ÄÏÇ¨Ïã§ ÎÇ¥ Î≥ëÎ¶¨Í≥º ÏÑúÎ≤Ñ Ïª¥Ìì®ÌÑ∞ÏóêÏÑú Î≥¥Í¥Ä, Í¥ÄÎ¶¨ÎêòÍ≥† ÏûàÏäµÎãàÎã§.</p>
                        <p>‚Ä¢ Î≥∏ Í≤ÄÏÇ¨Ïùò Í≤∞Í≥ºÎäî Í≤ÄÏ≤¥Ïóê Ìè¨Ìï®Îêú Ï†ïÏÉÅÏÑ∏Ìè¨ÏôÄ ÏïîÏÑ∏Ìè¨Ïùò ÎπÑÏú®Ïóê Îî∞Îùº ÏúÑÏùåÏÑ±Ïùò Í≤∞Í≥ºÎ•º Î∞∞Ï†ú Ìï† Ïàò ÏóÜÏäµÎãàÎã§.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page 2: Í≤ÄÏÇ¨Ï†ïÎ≥¥Î∂ÄÌÑ∞ SpecificationÍπåÏßÄ -->
        <div class="a4-page page-2">
            <div class="page-border">
                <div class="page-2-content">
                    <!-- Í≤ÄÏÇ¨Ï†ïÎ≥¥ -->
                    <div class="section">
                        <h2 class="section-title">‚ñ£ Í≤ÄÏÇ¨Ï†ïÎ≥¥</h2>
                        <div class="info-section">
                            <p><span class="info-label">Í≤ÄÏÇ¨ÏãúÏïΩ :</span> {% if report_data.panel_type == 'GE' %}AllPrep
                                DNA/RNA
                                FFPE Kit (50) [Qiagen], TruSight‚Ñ¢ Oncology 500 kit [Illumina]{% else %}AllPrep DNA/RNA
                                FFPE
                                Kit (50) [Qiagen], TruSight‚Ñ¢ Oncology 500 kit [Illumina], TruSight‚Ñ¢ RNA Fusion Panel
                                [Illumina]{% endif %}</p>
                            <p><span class="info-label">Í≤ÄÏÇ¨Î∞©Î≤ï :</span> NGS targeted DNA/RNA sequencing (Library : Hybrid
                                capture)</p>
                            <p><span class="info-label">Í≤ÄÏÇ¨Í∏∞Í∏∞ :</span> {{ report_data.diagnostic_info.Í≤ÄÏÇ¨Í∏∞Í∏∞ }}</p>
                            <p><span class="info-label">Reference genome :</span> Homo_sapiens/ UCSC/ hg19</p>
                        </div>
                    </div>

                    <!-- Filter history -->
                    <div class="section">
                        <h2 class="section-title">‚ñ£ Filter history</h2>
                        <div class="info-section">
                            <p><span class="info-label">Include :</span> Exonic, Illumina Q.C Filter PASS, Fold change
                                &lt;0.5
                                or &gt;1.5</p>
                            <p><span class="info-label">Exclude :</span> Synonymous, VAF &lt;3%, total depth &lt;100,
                                refer
                                depth=0</p>
                        </div>
                    </div>

                    <!-- DNA, RNA -->
                    <div class="section">
                        <h2 class="section-title">‚ñ£ DNA, RNA <span class="small-text">(Qubit ÎÜçÎèÑ)</span></h2>
                        <div class="info-section">
                            <p><span class="info-label">DNA (ng/ul) :</span> {{ report_data.drna_qubit.DNA }}
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <span class="info-label">RNA (ng/ul) :</span> {{ report_data.drna_qubit.RNA }}
                            </p>
                        </div>
                    </div>

                    <!-- Q.C -->
                    <div class="section">
                        <h2 class="section-title">‚ñ£ Q.C</h2>
                        <div class="info-section">
                            <div class="qc-simple">
                                <div class="qc-header">
                                    <span class="qc-col-tight">Metric (UOM)</span>
                                    <span class="qc-col-tight">LSL Guideline</span>
                                    <span class="qc-col-tight">Value</span>
                                </div>
                                {% if report_data.qc.data %}
                                {% for row in report_data.qc.data %}
                                <div class="qc-row-simple">
                                    <span class="qc-col-tight">{{ row[0] }}</span>
                                    <span class="qc-col-tight">{{ row[1] }}</span>
                                    <span class="qc-col-tight">{{ row[2] }}</span>
                                </div>
                                {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Analysis Program -->
                    <div class="section">
                        <h2 class="section-title">‚ñ£ Analysis Program</h2>
                        <div class="info-section">
                            <p>DRAGEN TSO500 ( Workflow Version : 2.5.2 )</p>
                        </div>
                    </div>

                    <!-- Specification -->
                    <div class="section">
                        <h2 class="section-title">‚ñ£ Specification</h2>
                        <div class="specification-box" id="specification-content">
                            <!-- ÎèôÏ†ÅÏúºÎ°ú Î°úÎìúÎê® -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page 3: Gene Content -->
        {% if report_data.panel_type == 'GE' %}
        <!-- GE: Ìïú ÌéòÏù¥ÏßÄÏóê Gene Content + Footer -->
        <div class="a4-page page-3">
            <div class="page-border">
                <div class="page-3-content">
                    <div class="gene-content-wrapper">
                        <div class="section">
                            <h2 class="section-title">‚ñ£ Gene Content in the TruSight Oncology 500 panel Assay</h2>
                            <div class="gene-content-box" id="ge-gene-content">
                                <!-- ÎèôÏ†ÅÏúºÎ°ú Î°úÎìúÎê® -->
                            </div>
                        </div>
                    </div>

                    <!-- ÎßàÏßÄÎßâ ÌéòÏù¥ÏßÄ: ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ + Footer -->
                    <div class="page-footer-wrapper">
                        <!-- ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ (ÎßàÏßÄÎßâ ÌéòÏù¥ÏßÄÏóêÎßå) -->
                        <div class="user-info-section">
                            <div class="user-info-divider"></div>
                            <div class="user-info-container">
                                <div class="user-info-number-row">
                                    <table class="user-number-table">
                                        <tr>
                                            <td class="user-number-label">Î∂ÑÏûê Ï†ëÏàò Î≤àÌò∏</td>
                                            <td class="user-number-value">{{ report_data.diagnosis_user['Î∂ÑÏûêÏ†ëÏàòÎ≤àÌò∏'] }}
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="user-info-tested-row">
                                    <span class="user-tested"><strong>Tested by:</strong> {{
                                        report_data.diagnosis_user['Tested by'] }}</span>
                                    <span class="user-analyzed"><strong>Analyzed by:</strong> {{
                                        report_data.diagnosis_user['Analyzed by'] }}</span>
                                </div>
                                <div class="user-info-signed-row">
                                    <span class="user-signed"><strong>Signed by:</strong> {{
                                        report_data.diagnosis_user['Signed by'] }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Footer (Î°úÍ≥†ÏôÄ Í≤ÄÏÇ¨Í∏∞Í¥Ä Ï†ïÎ≥¥Îßå) -->
                        <div class="report-footer">
                            <div class="footer-container">
                                <div class="footer-row">
                                    <div class="footer-left">
                                        <div class="footer-org">Í≤ÄÏÇ¨Í∏∞Í¥Ä : ÏÑ∏Î∏åÎûÄÏä§Î≥ëÏõê Î≥ëÎ¶¨Í≥º Î∂ÑÏûêÎ≥ëÎ¶¨ Í≤ÄÏÇ¨Ïã§</div>
                                        <div class="footer-address">ÏÑúÏö∏Ïãú ÏÑúÎåÄÎ¨∏Íµ¨ Ïó∞ÏÑ∏Î°ú 50-1 (Ïã†Ï¥åÎèô 134) ÏÑ∏Î∏åÎûÄÏä§Î≥ëÏõê Î≥ëÎ¶¨Í≥º Tel:
                                            02-2228-2625
                                        </div>
                                    </div>
                                    <div class="footer-right">
                                        <img src="/static/images/Sev_Logo.png" alt="ÏÑ∏Î∏åÎûÄÏä§Î≥ëÏõê">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <!-- SA: DNA ÌéòÏù¥ÏßÄ -->
        <div class="a4-page page-3">
            <div class="page-border">
                <div class="page-3-content">
                    <div class="gene-content-wrapper" style="margin-top: 15px;">
                        <div class="section">
                            <h2 class="section-title">‚ñ£ Gene Content in the NGS Sarcoma Panel Assay [DNA]</h2>
                            <div class="gene-content-box" id="sa-gene-content-dna">
                                <!-- ÎèôÏ†ÅÏúºÎ°ú Î°úÎìúÎê® -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SA: RNA ÌéòÏù¥ÏßÄ + Footer -->
        <div class="a4-page page-4">
            <div class="page-border">
                <div class="page-4-content">
                    <div class="gene-content-wrapper" style="margin-top: 15px;">
                        <div class="section">
                            <h2 class="section-title">‚ñ£ Gene Content in the NGS Sarcoma Panel Assay [RNA]</h2>
                            <div class="gene-content-box" id="sa-gene-content-rna">
                                <!-- ÎèôÏ†ÅÏúºÎ°ú Î°úÎìúÎê® -->
                            </div>
                        </div>
                    </div>

                    <!-- ÎßàÏßÄÎßâ ÌéòÏù¥ÏßÄ: ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ + Footer -->
                    <div class="page-footer-wrapper">
                        <!-- ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ (ÎßàÏßÄÎßâ ÌéòÏù¥ÏßÄÏóêÎßå) -->
                        <div class="user-info-section">
                            <div class="user-info-divider"></div>
                            <div class="user-info-container">
                                <div class="user-info-number-row">
                                    <table class="user-number-table">
                                        <tr>
                                            <td class="user-number-label">Î∂ÑÏûê Ï†ëÏàò Î≤àÌò∏</td>
                                            <td class="user-number-value">{{ report_data.diagnosis_user['Î∂ÑÏûêÏ†ëÏàòÎ≤àÌò∏'] }}
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="user-info-tested-row">
                                    <span class="user-tested"><strong>Tested by:</strong> {{
                                        report_data.diagnosis_user['Tested by'] }}</span>
                                    <span class="user-analyzed"><strong>Analyzed by:</strong> {{
                                        report_data.diagnosis_user['Analyzed by'] }}</span>
                                </div>
                                <div class="user-info-signed-row">
                                    <span class="user-signed"><strong>Signed by:</strong> {{
                                        report_data.diagnosis_user['Signed by'] }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Footer (Î°úÍ≥†ÏôÄ Í≤ÄÏÇ¨Í∏∞Í¥Ä Ï†ïÎ≥¥Îßå) -->
                        <div class="report-footer">
                            <div class="footer-container">
                                <div class="footer-row">
                                    <div class="footer-left">
                                        <div class="footer-org">Í≤ÄÏÇ¨Í∏∞Í¥Ä : ÏÑ∏Î∏åÎûÄÏä§Î≥ëÏõê Î≥ëÎ¶¨Í≥º Î∂ÑÏûêÎ≥ëÎ¶¨ Í≤ÄÏÇ¨Ïã§</div>
                                        <div class="footer-address">ÏÑúÏö∏Ïãú ÏÑúÎåÄÎ¨∏Íµ¨ Ïó∞ÏÑ∏Î°ú 50-1 (Ïã†Ï¥åÎèô 134) ÏÑ∏Î∏åÎûÄÏä§Î≥ëÏõê Î≥ëÎ¶¨Í≥º Tel:
                                            02-2228-2625
                                        </div>
                                    </div>
                                    <div class="footer-right">
                                        <img src="/static/images/Sev_Logo.png" alt="ÏÑ∏Î∏åÎûÄÏä§Î≥ëÏõê">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Î∂ÑÌï†Îêú CNV ÌÖåÏù¥Î∏îÏùÑ ÏúÑÌïú Ï∂îÍ∞Ä ÌéòÏù¥ÏßÄ (ÌïÑÏöîÏãú ÎèôÏ†Å ÏÉùÏÑ±) -->
    <div class="a4-page page-cnv-continued" id="cnv-continued-page" style="display: none;">
        <div class="page-border">
            <div class="report-content">
                <!-- CNV Î∂ÑÌï† ÌÖåÏù¥Î∏î (2/2) -->
                <div id="cnv-continued-section">
                    <!-- JavaScriptÎ°ú ÎèôÏ†Å ÏÉùÏÑ± -->
                </div>
            </div>

            <!-- Ï≤´ ÌéòÏù¥ÏßÄ ÌïòÎã® Í≥†Ï†ï Ïª®ÌÖêÏ∏† Î≥µÏÇ¨ -->
            <div class="page-bottom-fixed">
                <!-- 5. Other Biomarkers -->
                <div class="section">
                    {% set tmb_status = report_data.biomarkers.TMB.status | lower %}
                    {% set msi_status = report_data.biomarkers.MSI.status | lower %}
                    {% set is_tmb_high = 'high' in tmb_status %}
                    {% set is_msi_high = 'high' in msi_status %}

                    <h3 class="result-title">5. Other Biomarkers
                        {% if is_tmb_high and is_msi_high %}
                        <span class="clinical-highlight">: TMB-High and MSI-High</span>
                        {% elif is_tmb_high %}
                        <span class="clinical-highlight">: TMB-High</span>
                        {% elif is_msi_high %}
                        <span class="clinical-highlight">: MSI-High</span>
                        {% endif %}
                    </h3>
                    <table class="biomarkers-table">
                        <thead>
                            <tr>
                                <th>Biomarker</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Tumor Mutational Burden (TMB)</td>
                                <td><span class="{% if is_tmb_high %}clinical-highlight{% endif %}">{{
                                        report_data.biomarkers.TMB.value }}</span> {{ report_data.biomarkers.TMB.unit }}
                                </td>
                            </tr>
                            <tr>
                                <td>Microsatellite Instability (MSI)</td>
                                <td><span class="{% if is_msi_high %}clinical-highlight{% endif %}">{{
                                        report_data.biomarkers.MSI.value }}</span> {{ report_data.biomarkers.MSI.unit }}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Footer (Î°úÍ≥†ÏôÄ Í≤ÄÏÇ¨Í∏∞Í¥Ä Ï†ïÎ≥¥Îßå) -->
                <div class="report-footer">
                    <div class="footer-container">
                        <div class="footer-row">
                            <div class="footer-left">
                                <div class="footer-org">Í≤ÄÏÇ¨Í∏∞Í¥Ä : ÏÑ∏Î∏åÎûÄÏä§Î≥ëÏõê Î≥ëÎ¶¨Í≥º Î∂ÑÏûêÎ≥ëÎ¶¨ Í≤ÄÏÇ¨Ïã§</div>
                                <div class="footer-address">ÏÑúÏö∏Ïãú ÏÑúÎåÄÎ¨∏Íµ¨ Ïó∞ÏÑ∏Î°ú 50-1 (Ïã†Ï¥åÎèô 134) ÏÑ∏Î∏åÎûÄÏä§Î≥ëÏõê Î≥ëÎ¶¨Í≥º Tel: 02-2228-2625
                                </div>
                            </div>
                            <div class="footer-right">
                                <img src="/static/images/Sev_Logo.png" alt="ÏÑ∏Î∏åÎûÄÏä§Î≥ëÏõê">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Í≤ÄÏ≤¥ IDÏôÄ Ìå®ÎÑê ÌÉÄÏûÖÏùÑ JavaScriptÎ°ú Ï†ÑÎã¨
        window.specimenId = '{{ specimen_id }}';
        window.panelType = '{{ report_data.panel_type }}';

        // Specification ÎèôÏ†Å Î°úÎìú
        async function loadSpecification() {
            const specContainer = document.getElementById('specification-content');
            if (!specContainer || !window.panelType) return;

            try {
                const response = await fetch(`/api/specification/${window.panelType}?t=${Date.now()}`);
                if (response.ok) {
                    const html = await response.text();
                    specContainer.innerHTML = html;
                } else {
                    specContainer.innerHTML = '<p style="text-align: center; color: #999;">Specification Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</p>';
                }
            } catch (error) {
                console.error('Specification Î°úÎìú Ïò§Î•ò:', error);
                specContainer.innerHTML = '<p style="text-align: center; color: #999;">Specification Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</p>';
            }
        }

        // Gene Content ÎèôÏ†Å Î°úÎìú
        async function loadGeneContent() {
            if (!window.panelType) return;

            if (window.panelType === 'GE') {
                await loadGEGeneContent();
            } else if (window.panelType === 'SA') {
                await loadSAGeneContent();
            }
        }

        // GE Gene Content Î°úÎìú
        async function loadGEGeneContent() {
            const container = document.getElementById('ge-gene-content');
            if (!container) return;

            try {
                const response = await fetch('/api/gene-content/GE_Gene_Content_DRNA');
                if (response.ok) {
                    const html = await response.text();
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<p style="text-align: center; color: #999;">Gene Content Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</p>';
                }
            } catch (error) {
                console.error('GE Gene Content Î°úÎìú Ïò§Î•ò:', error);
                container.innerHTML = '<p style="text-align: center; color: #999;">Gene Content Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</p>';
            }
        }

        // SA Gene Content Î°úÎìú
        async function loadSAGeneContent() {
            const dnaContainer = document.getElementById('sa-gene-content-dna');
            const rnaContainer = document.getElementById('sa-gene-content-rna');

            // DNA Content Î°úÎìú
            if (dnaContainer) {
                try {
                    const response = await fetch('/api/gene-content/SA_Gene_Content_DNA');
                    if (response.ok) {
                        const html = await response.text();
                        dnaContainer.innerHTML = html;
                    } else {
                        dnaContainer.innerHTML = '<p style="text-align: center; color: #999;">DNA Gene Content Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</p>';
                    }
                } catch (error) {
                    console.error('SA DNA Gene Content Î°úÎìú Ïò§Î•ò:', error);
                    dnaContainer.innerHTML = '<p style="text-align: center; color: #999;">DNA Gene Content Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</p>';
                }
            }

            // RNA Content Î°úÎìú
            if (rnaContainer) {
                try {
                    const response = await fetch('/api/gene-content/SA_Gene_Content_RNA');
                    if (response.ok) {
                        const html = await response.text();
                        rnaContainer.innerHTML = html;
                    } else {
                        rnaContainer.innerHTML = '<p style="text-align: center; color: #999;">RNA Gene Content Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</p>';
                    }
                } catch (error) {
                    console.error('SA RNA Gene Content Î°úÎìú Ïò§Î•ò:', error);
                    rnaContainer.innerHTML = '<p style="text-align: center; color: #999;">RNA Gene Content Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</p>';
                }
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú SpecificationÍ≥º Gene Content Î°úÎìú
        document.addEventListener('DOMContentLoaded', function () {
            loadSpecification();
            loadGeneContent();
        });

        // Ï†ïÌôïÌïú DOM ÏàúÏÑú Í∏∞Î∞ò ÏΩòÌÖêÏ∏† Î∞∞Ïπò Î∞è Î∂ÑÌï† - Í≥µÍ∞Ñ ÏµúÎåÄ ÌôúÏö© Í∞úÏÑ†Ìåê (Ï†úÎ™© Ï≤òÎ¶¨ Ìè¨Ìï®)
        function checkAndSplitTables() {
            console.log('=== STARTING TABLE SPLIT CHECK ===');

            const page1 = document.querySelector('.page-1');
            if (!page1) {
                console.log('Page 1 not found');
                return;
            }

            const bottomFixed = page1.querySelector('.page-bottom-fixed');
            if (!bottomFixed) {
                console.log('Bottom fixed not found');
                return;
            }

            // Î™®Îì† splittable-section Ï∞æÍ∏∞
            const splittableSections = document.querySelectorAll('.splittable-section');

            splittableSections.forEach((section, index) => {
                const table = section.querySelector('table');
                if (!table) return;

                const thead = table.querySelector('thead');
                const tbody = table.querySelector('tbody');
                const rows = tbody ? tbody.querySelectorAll('tr') : [];

                if (rows.length === 0) return;

                console.log(`Checking section ${index}: ${section.dataset.sectionName}, rows: ${rows.length}`);

                // data-split-at ÏÜçÏÑ± ÌôïÏù∏ (Î∞±ÏóîÎìúÏóêÏÑú ÏÑ§Ï†ïÌïú Î∂ÑÌï† ÏßÄÏ†ê)
                const splitAtAttr = section.dataset.splitAt;
                if (splitAtAttr) {
                    const splitAt = parseInt(splitAtAttr);
                    console.log(`Using data-split-at value: ${splitAt}`);

                    // Î∞±ÏóîÎìúÏóêÏÑú ÏßÄÏ†ïÌïú Î∂ÑÌï† ÏßÄÏ†êÏù¥ ÏûàÍ≥†, Îç∞Ïù¥ÌÑ∞Í∞Ä Í∑∏Î≥¥Îã§ ÎßéÏúºÎ©¥ Î∂ÑÌï†
                    if (rows.length > splitAt) {
                        console.log(`Splitting table at row ${splitAt} based on data-split-at`);
                        splitTableAtRow(section, splitAt);
                        return; // Îã§Ïùå ÏÑπÏÖòÏúºÎ°ú
                    }
                }

                // data-split-atÏù¥ ÏóÜÍ±∞ÎÇò Ï†ÅÏö©ÎêòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞, Í∏∞Ï°¥Ï≤òÎüº ÎèôÏ†Å Í≥ÑÏÇ∞
                // ÌÖåÏù¥Î∏îÏùò ÌòÑÏû¨ ÏúÑÏπòÏôÄ ÌïòÎã® Í≥†Ï†ï ÏöîÏÜå ÏúÑÏπò ÌôïÏù∏
                const sectionRect = section.getBoundingClientRect();
                const bottomFixedRect = bottomFixed.getBoundingClientRect();

                // ÌÖåÏù¥Î∏îÏù¥ ÌéòÏù¥ÏßÄ ÌïòÎã®ÏùÑ Ï¥àÍ≥ºÌïòÎäîÏßÄ Ï≤¥ÌÅ¨
                if (sectionRect.bottom > bottomFixedRect.top - 5) { // ÏïàÏ†Ñ Ïó¨Î∞± ÏµúÏÜåÌôî (20px ‚Üí 5px)
                    console.log(`Table ${section.dataset.sectionName} exceeds page bounds`);

                    // Ï†úÎ™© Ï≤¥ÌÅ¨
                    const title = section.querySelector('.variant-type, h4');
                    const titleHeight = title ? title.offsetHeight : 0;
                    const titleRect = title ? title.getBoundingClientRect() : null;

                    // Ï†úÎ™©Ïù¥ ÌéòÏù¥ÏßÄ Í≤ΩÍ≥ÑÏóê Í±∏ÏπòÎäî Í≤ΩÏö∞
                    if (titleRect && titleRect.bottom > bottomFixedRect.top - 5) {
                        console.log(`üìã Ï†úÎ™©Ïù¥ ÌéòÏù¥ÏßÄ Í≤ΩÍ≥ÑÏóê Í±∏Ïπ®: ${title.textContent}`);
                        // Ï†úÎ™©Ïù¥ Í±∏ÏπòÎäî Í≤ΩÏö∞ Ï†ÑÏ≤¥ ÏÑπÏÖòÏùÑ Îã§Ïùå ÌéòÏù¥ÏßÄÎ°ú
                        moveFullSectionToNextPage(section);
                        return; // Îã§Ïùå ÏÑπÏÖòÏúºÎ°ú
                    }

                    // ÌÖåÏù¥Î∏î Î∂ÑÌï† Ï≤òÎ¶¨
                    const headerHeight = thead ? thead.offsetHeight : 0;
                    const tableTop = sectionRect.top;
                    const availableSpace = bottomFixedRect.top - tableTop - 3; // ÏïàÏ†Ñ Ïó¨Î∞± ÏµúÏÜåÌôî (20px ‚Üí 3px)

                    console.log(`Available space: ${availableSpace}px`);
                    console.log(`Title height: ${titleHeight}px`);
                    console.log(`Header height: ${headerHeight}px`);

                    // Ï†úÎ™©Í≥º Ìó§ÎçîÎ•º Ï†úÏô∏Ìïú Ïã§Ï†ú Îç∞Ïù¥ÌÑ∞ ÏòÅÏó≠
                    let usedHeight = titleHeight + headerHeight;
                    let splitPoint = 0;

                    // Í∞Å ÌñâÏùò ÎÜíÏù¥Î•º Ï∏°Ï†ïÌïòÏó¨ Îì§Ïñ¥Í∞à Ïàò ÏûàÎäî ÏµúÎåÄ Ìñâ Ïàò Ï∞æÍ∏∞
                    for (let i = 0; i < rows.length; i++) {
                        const rowHeight = rows[i].offsetHeight;
                        console.log(`Row ${i} height: ${rowHeight}px, used: ${usedHeight}px, available: ${availableSpace}px`);

                        if (usedHeight + rowHeight <= availableSpace) {
                            usedHeight += rowHeight;
                            splitPoint = i + 1; // Ïù¥ ÌñâÍπåÏßÄÎäî Îì§Ïñ¥Í∞à Ïàò ÏûàÏùå
                        } else {
                            break; // Îçî Ïù¥ÏÉÅ Îì§Ïñ¥Í∞à Ïàò ÏóÜÏùå
                        }
                    }

                    console.log(`Can fit ${splitPoint} rows out of ${rows.length} in available space`);

                    // Í∞ÄÎä•Ìïú Ìïú ÏµúÎåÄÌïú ÎßéÏùÄ ÌñâÏùÑ Ï≤´ ÌéòÏù¥ÏßÄÏóê ÎÑ£Í∏∞
                    if (splitPoint === 0 && rows.length > 0) {
                        // Ï†ÑÏ≤¥ ÏÑπÏÖòÏùÑ Îã§Ïùå ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
                        console.log(`Cannot fit any rows, moving entire section`);
                        moveFullSectionToNextPage(section);
                    } else if (splitPoint > 0 && splitPoint < rows.length) {
                        // Í∞ÄÎä•Ìïú Ìïú ÎßéÏùÄ ÌñâÏùÑ Ï≤´ ÌéòÏù¥ÏßÄÏóê ÎÇ®Í∏∞Í≥† Î∂ÑÌï†
                        console.log(`Splitting at row ${splitPoint} to maximize space usage`);
                        splitTableAtRow(section, splitPoint);
                    }
                    // splitPoint === rows.lengthÏù∏ Í≤ΩÏö∞Îäî Î™®Îì† ÌñâÏù¥ Îì§Ïñ¥Í∞ÄÎØÄÎ°ú ÏïÑÎ¨¥Í≤ÉÎèÑ ÌïòÏßÄ ÏïäÏùå
                }
            });

            console.log('=== TABLE SPLIT CHECK COMPLETE ===');
        }

        // ÌÖåÏù¥Î∏îÏùÑ ÌäπÏ†ï ÌñâÏóêÏÑú Î∂ÑÌï†
        function splitTableAtRow(section, splitPoint) {
            const sectionName = section.dataset.sectionName;
            const tableType = section.dataset.tableType || '';
            const table = section.querySelector('table');
            const tbody = table.querySelector('tbody');
            const rows = tbody.querySelectorAll('tr');

            // Ï†úÎ™©Ïóê (1/2) Ï∂îÍ∞Ä
            const title = section.querySelector('.variant-type');
            if (title && !title.textContent.includes('(1/2)')) {
                title.innerHTML = title.innerHTML.replace(`- ${sectionName}`, `- ${sectionName} (1/2)`);
            }

            // Îã§Ïùå ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌï† ÌñâÎì§ ÏàòÏßë
            const rowsToMove = [];
            for (let i = splitPoint; i < rows.length; i++) {
                rowsToMove.push(rows[i].cloneNode(true));
            }

            // ÏõêÎ≥∏ÏóêÏÑú Ï¥àÍ≥º Ìñâ Ï†úÍ±∞
            for (let i = rows.length - 1; i >= splitPoint; i--) {
                rows[i].remove();
            }

            // Îã§Ïùå ÌéòÏù¥ÏßÄ ÏÉùÏÑ± ÎòêÎäî Ï∞æÍ∏∞
            let nextPage = document.querySelector('.page-content-continued');
            if (!nextPage) {
                nextPage = createContinuedPage();
            }

            // Î∂ÑÌï†Îêú ÌÖåÏù¥Î∏î ÏÉùÏÑ±
            const newSection = createSplitSection(section, rowsToMove, sectionName, tableType);
            const nextContent = nextPage.querySelector('.report-content');
            nextContent.appendChild(newSection);
        }

        // Ï†ÑÏ≤¥ ÏÑπÏÖòÏùÑ Îã§Ïùå ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
        function moveFullSectionToNextPage(section) {
            let nextPage = document.querySelector('.page-content-continued');
            if (!nextPage) {
                nextPage = createContinuedPage();
            }

            const nextContent = nextPage.querySelector('.report-content');
            nextContent.appendChild(section);
        }

        // Ïó∞ÏÜç ÌéòÏù¥ÏßÄ ÏÉùÏÑ±
        function createContinuedPage() {
            const page1 = document.querySelector('.page-1');
            const newPage = document.createElement('div');
            newPage.className = 'a4-page page-content-continued';
            newPage.innerHTML = `
                <div class="page-border">
                    <div class="report-content"></div>
                </div>
            `;
            page1.parentNode.insertBefore(newPage, page1.nextSibling);
            return newPage;
        }

        // Î∂ÑÌï†Îêú ÏÑπÏÖò ÏÉùÏÑ±
        function createSplitSection(originalSection, rowsToMove, sectionName, tableType) {
            const newSection = document.createElement('div');
            newSection.className = 'continued-section';

            // ÏõêÎ≥∏ Ï†úÎ™©Ïùò ÌÅ¥ÎûòÏä§ÏôÄ ÌïòÏù¥ÎùºÏù¥Ìä∏ Î≥µÏÇ¨
            const originalTitle = originalSection.querySelector('.variant-type');
            const highlight = originalTitle ? originalTitle.querySelector('.clinical-highlight') : null;
            const highlightHTML = highlight ? highlight.outerHTML : '';
            const titleClasses = originalTitle ? originalTitle.className : 'variant-type';

            // ÌÖåÏù¥Î∏î Ìó§Îçî Î≥µÏÇ¨
            const originalTable = originalSection.querySelector('table');
            const originalHeader = originalTable.querySelector('thead').cloneNode(true);

            // ÏÉà ÌÖåÏù¥Î∏î ÏÉùÏÑ±
            const newTable = document.createElement('table');
            newTable.className = originalTable.className + ' split-table-continued';
            newTable.setAttribute('border', '1');

            const newTbody = document.createElement('tbody');
            rowsToMove.forEach(row => newTbody.appendChild(row));

            newTable.appendChild(originalHeader);
            newTable.appendChild(newTbody);

            // ÏÉà ÏÑπÏÖò Íµ¨ÏÑ±
            newSection.innerHTML = `
                <h4 class="${titleClasses}">- ${sectionName} (2/2)${highlightHTML}</h4>
            `;
            newSection.appendChild(newTable);

            return newSection;
        }

        // Í∏∞Ï°¥ Ìï®ÏàòÎì§ Ï†úÍ±∞ (ÏÉà Î°úÏßÅÏúºÎ°ú ÎåÄÏ≤¥)

        // ÌéòÏù¥ÏßÄ Î°úÎìú ÌõÑ ÌÖåÏù¥Î∏î Î∂ÑÌï† Ï≤¥ÌÅ¨ - Í∞ÑÎã®ÌïòÍ≤å
        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM Content Loaded');

            /* 
             Legacy code removed to prevent conflict with script.js dynamicClinicalPagination
            setTimeout(() => {
                console.log('Final check after 1500ms');
                checkAndSplitTables();
            }, 1500);
            */
        });

        /*
        // ÏúàÎèÑÏö∞ Î¶¨ÏÇ¨Ïù¥Ï¶à ÏãúÏóêÎèÑ Ï≤¥ÌÅ¨
        window.addEventListener('resize', function () {
            console.log('Window resized');
            setTimeout(() => {
                checkAndSplitTables();
            }, 500);
        });

        // Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÏôÑÎ£å ÌõÑÏóêÎèÑ Ï≤¥ÌÅ¨
        window.addEventListener('load', function () {
            console.log('Window fully loaded (including images)');
            setTimeout(() => {
                console.log('Final check after full load');
                checkAndSplitTables();
            }, 2000);
        });
        
        function checkAndSplitTables() {
             // Disabled
        }
        */
    </script>
    <script src="/static/js/script.js?v=18.12"></script>

    <!-- PDF Îã§Ïö¥Î°úÎìú Ïä§ÌÅ¨Î¶ΩÌä∏ -->
    <!-- <script src="/static/js/report.js"></script> -->
</body>

</html>