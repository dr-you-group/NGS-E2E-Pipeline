<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NGS Panel Level II Analysis Report</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <div class="container">
        <!-- PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
        <div class="report-controls">
            <button id="pdf-download-btn" class="pdf-btn">
                ğŸ“„ PDF ë‹¤ìš´ë¡œë“œ
            </button>
        </div>
        <!-- ë””ë²„ê·¸ ì •ë³´ (ê°œë°œ ì¤‘ì—ë§Œ ì‚¬ìš©) -->
        {% if debug %}
        <div class="debug-info">
            <h3>ë””ë²„ê·¸ ì •ë³´</h3>
            <pre>{{ report_data | tojson(indent=4) }}</pre>
        </div>
        {% endif %}

        <!-- Page 1: ê²€ì²´ì •ë³´ + ì¼ë¶€ ê²€ì‚¬ê²°ê³¼ + Other biomarkers + Footer -->
        <div class="a4-page page-1">
            <div class="page-border">
                <div style="position: relative; height: 100%;">
                    <div class="report-content">
                        <!-- ë³´ê³ ì„œ í—¤ë” -->
                        <div class="report-header">
                            <h1>NGS Panel Level II Analysis Report</h1>
                        </div>
                    
                        <!-- ê²€ì²´ ì •ë³´ -->
                        <div class="section">
                            <h2 class="section-title">â–£ ê²€ì²´ ì •ë³´</h2>
                            <table class="info-table full-width" border="1">
                                <tr>
                                    <th>ê²€ì²´ ì •ë³´</th>
                                    <th>ì„±ë³„</th>
                                    <th>ë‚˜ì´</th>
                                    <th>Unit NO.</th>
                                    <th>í™˜ìëª…</th>
                                    <th>ì±„ì·¨ ì¥ê¸°</th>
                                    <th>ì›ë°œ ì¥ê¸°</th>
                                    <th colspan="2">ì§„ë‹¨</th>
                                </tr>
                                <tr>
                                    <td>{{ report_data.clinical_info['ê²€ì²´ ì •ë³´'] }}</td>
                                    <td>{{ report_data.clinical_info.ì„±ë³„ }}</td>
                                    <td>{{ report_data.clinical_info.ë‚˜ì´ }}</td>
                                    <td>{{ report_data.clinical_info['Unit NO.'] }}</td>
                                    <td>{{ report_data.clinical_info.í™˜ìëª… }}</td>
                                    <td>{{ report_data.clinical_info['ì±„ì·¨ ì¥ê¸°'] }}</td>
                                    <td>{{ report_data.clinical_info['ì›ë°œ ì¥ê¸°'] }}</td>
                                    <td colspan="2">{{ report_data.clinical_info.ì§„ë‹¨ }}</td>
                                </tr>
                                <tr>
                                    <th>ì˜ë¢°ì˜</th>
                                    <th colspan="3" style="width: 20%;">ì˜ë¢°ì˜ ì†Œì†</th>
                                    <th>ê²€ì²´ ìœ í˜•</th>
                                    <th colspan="2">ê²€ì²´ì˜ ì ì ˆì„±ì—¬ë¶€</th>
                                    <th>ê²€ì²´ì ‘ìˆ˜ì¼</th>
                                    <th>ê²°ê³¼ë³´ê³ ì¼</th>
                                </tr>
                                <tr>
                                    <td>{{ report_data.clinical_info['ì˜ë¢°ì˜'] }}</td>
                                    <td colspan="3" style="width: 20%;">{{ report_data.clinical_info['ì˜ë¢°ì˜ ì†Œì†'] }}</td>
                                    <td>{{ report_data.clinical_info['ê²€ì²´ ìœ í˜•'] }}</td>
                                    <td colspan="2">{{ report_data.clinical_info['ê²€ì²´ì˜ ì ì ˆì„±ì—¬ë¶€'] }}</td>
                                    <td>{{ report_data.clinical_info['ê²€ì²´ì ‘ìˆ˜ì¼'] }}</td>
                                    <td>{{ report_data.clinical_info.get('ê²°ê³¼ë³´ê³ ì¼', 'N/A') }}</td>
                                </tr>
                            </table>
                        </div>
                        
                        <!-- ê²€ì‚¬ê²°ê³¼ -->
                        <div class="section">
                            <h2 class="section-title">â–£ ê²€ì‚¬ê²°ê³¼</h2>
                            
                            <!-- 1. Variants of clinical significance -->
                            <h3 class="result-title">1. Variants of clinical significance</h3>
                            
                            <!-- SNVs & Indels (ë¶„í•  ê°€ëŠ¥) -->
                            {% if report_data.snv_clinical.data %}
                            <div id="snv-clinical-section" class="splittable-section" data-section-name="SNVs & Indels" data-table-type="clinical">
                                <h4 class="variant-type snv-title">- SNVs & Indels{% if report_data.snv_clinical.highlight %}<span class="clinical-highlight">: {{ report_data.snv_clinical.highlight }}</span>{% endif %}</h4>
                            <table class="data-table full-width" border="1" id="snv-clinical-table">
                            <thead>
                                <tr>
                                    <th>GENE</th>
                                    <th>MUTATION TYPE</th>
                                    <th>AA CHANGE</th>
                                    <th>VAF (%)</th>
                                        <th>HGVSc</th>
                                        <th>HGVSp</th>
                                    </tr>
                            </thead>
                            <tbody>
                                {% for row in report_data.snv_clinical.data %}
                                    <tr class="snv-data-row">
                                        {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <h4 class="variant-type">- SNVs & Indels<span class="none-text">: None</span></h4>
            {% endif %}
                            
                            <!-- Fusion gene (ë¶„í•  ê°€ëŠ¥) -->
                            {% if report_data.fusion_clinical.data %}
                            <div id="fusion-clinical-section" class="splittable-section" data-section-name="Fusion gene" data-table-type="clinical">
                                <h4 class="variant-type fusion-title">- Fusion gene{% if report_data.fusion_clinical.highlight %}<span class="clinical-highlight">: {{ report_data.fusion_clinical.highlight }}</span>{% endif %}</h4>
                            <table class="data-table full-width" border="1" id="fusion-clinical-table">
                            <thead>
                                <tr>
                                    <th>GENE FUSION</th>
                                    <th>BREAKPOINT 1</th>
                                        <th>BREAKPOINT 2</th>
                                        <th>FUSION SUPPORTING READS</th>
                                    </tr>
                            </thead>
                            <tbody>
                                {% for row in report_data.fusion_clinical.data %}
                                    <tr class="fusion-data-row">
                                        {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <h4 class="variant-type">- Fusion gene<span class="none-text">: None</span></h4>
            {% endif %}
                            
                            <!-- Copy number variation (ë¶„í•  ê°€ëŠ¥) -->
                            {% if report_data.cnv_clinical.data %}
                            <div id="cnv-clinical-section" class="splittable-section" data-section-name="Copy number variation">
                                <h4 class="variant-type cnv-title">- Copy number variation{% if report_data.cnv_clinical.highlight %}<span class="clinical-highlight">: {{ report_data.cnv_clinical.highlight }}</span>{% endif %}</h4>
                            <table class="data-table full-width" border="1" id="cnv-clinical-table">
                            <thead>
                                <tr>
                                    <th>GENE</th>
                                    <th>LOCATION</th>
                                        <th>FOLD CHANGE</th>
                                        <th>ESTIMATED COPY NUMBER</th>
                                    </tr>
                            </thead>
                            <tbody>
                                {% for row in report_data.cnv_clinical.data %}
                                    <tr class="cnv-data-row">
                                        {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <h4 class="variant-type">- Copy number variation<span class="none-text">: None</span></h4>
            {% endif %}
                            
                            <!-- Large rearrangements in BRCA1/2 (ë¶„í•  ê°€ëŠ¥) -->
                            {% if report_data.lr_brca_clinical.data %}
                            <div id="lr-brca-clinical-section" class="splittable-section" data-section-name="Large rearrangements in BRCA1/2" data-table-type="clinical">
                                <h4 class="variant-type lr-brca-title">- Large rearrangements in BRCA1/2{% if report_data.lr_brca_clinical.highlight %}<span class="clinical-highlight">: {{ report_data.lr_brca_clinical.highlight }}</span>{% endif %}</h4>
                            <table class="data-table full-width" border="1" id="lr-brca-clinical-table">
                            <thead>
                                <tr>
                                    <th>GENE</th>
                                    <th>LOCATION</th>
                                    <th>AFFECTED EXON</th>
                                        <th>FOLD CHANGE</th>
                                        <th>ESTIMATED COPY NUMBER</th>
                                    </tr>
                            </thead>
                            <tbody>
                                {% for row in report_data.lr_brca_clinical.data %}
                                    <tr class="lr-brca-data-row">
                                        {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <h4 class="variant-type">- Large rearrangements in BRCA1/2<span class="none-text">: None</span></h4>
            {% endif %}
                            
                            <!-- Splice variant (ë¶„í•  ê°€ëŠ¥) -->
                            {% if report_data.splice_clinical.data %}
                            <div id="splice-clinical-section" class="splittable-section" data-section-name="Splice variant" data-table-type="clinical">
                                <h4 class="variant-type splice-title">- Splice variant{% if report_data.splice_clinical.highlight %}<span class="clinical-highlight">: {{ report_data.splice_clinical.highlight }}</span>{% endif %}</h4>
                            <table class="data-table full-width" border="1" id="splice-clinical-table">
                            <thead>
                                <tr>
                                    <th>GENE</th>
                                    <th>AFFECTED EXON</th>
                                    <th>BREAKPOINT 1</th>
                                        <th>BREAKPOINT 2</th>
                                        <th>SPLICE SUPPORTING READS</th>
                                    </tr>
                            </thead>
                            <tbody>
                                {% for row in report_data.splice_clinical.data %}
                                    <tr class="splice-data-row">
                                        {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <h4 class="variant-type">- Splice variant<span class="none-text">: None</span></h4>
            {% endif %}
                        </div>
                    </div>
                    
                    <!-- ì²« í˜ì´ì§€ í•˜ë‹¨ ê³ ì • ì»¨í…ì¸  -->
                    <div class="page-bottom-fixed">
                        <!-- Other Biomarkers -->
                        <div class="section">
                            <h4 class="variant-type">- Other Biomarkers</h4>
                            <table class="biomarkers-table full-width" border="1">
                                <tr>
                                    <th>Estimated Tumor Mutation Burden (TMB)</th>
                                    <th>Microsatellite Instability (MSI) (% Unstable MSI Sites)</th>
                                </tr>
                                <tr>
                                    <td>{{ report_data.biomarkers.TMB }}</td>
                                    <td>{{ report_data.biomarkers.MSI }}</td>
                                </tr>
                            </table>
                        </div>
                        
                        <!-- Footer (ë¡œê³ ì™€ ê²€ì‚¬ê¸°ê´€ ì •ë³´ë§Œ) -->
                        <div class="report-footer">
                            <div class="footer-container">
                                <div class="footer-row">
                                    <div class="footer-left">
                                        <div class="footer-org">ê²€ì‚¬ê¸°ê´€ : ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ ë¶„ìë³‘ë¦¬ ê²€ì‚¬ì‹¤</div>
                                        <div class="footer-address">ì„œìš¸ì‹œ ì„œëŒ€ë¬¸êµ¬ ì—°ì„¸ë¡œ 50-1 (ì‹ ì´Œë™ 134) ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ Tel: 02-2228-2625</div>
                                    </div>
                                    <div class="footer-right">
                                        <img src="/static/images/Sev_Logo.png" alt="ì„¸ë¸Œë€ìŠ¤ë³‘ì›">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Page 1-continued: ê²€ì‚¬ê²°ê³¼ ë‚˜ë¨¸ì§€ ë¶€ë¶„ -->
        <div class="a4-page page-continued page-continued-1">
            <div class="page-border">
                <div class="report-content">
                    <!-- 2. Variants of unknown significance -->
                    <h3 class="result-title">2. Variants of unknown significance</h3>
                    
                    <!-- SNVs & Indels -->
                    {% if report_data.snv_unknown.data %}
                    <h4 class="variant-type">- SNVs & Indels{% if report_data.snv_unknown.highlight %}: {{ report_data.snv_unknown.highlight }}{% endif %}</h4>
                    <table class="data-table full-width" border="1" id="snv-unknown-table">
                        <tr>
                            <th>GENE</th>
                            <th>MUTATION TYPE</th>
                            <th>AA CHANGE</th>
                            <th>VAF (%)</th>
                            <th>HGVSc</th>
                            <th>HGVSp</th>
                        </tr>
                        {% for row in report_data.snv_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- SNVs & Indels<span class="none-text">: None</span></h4>
                    {% endif %}
                    
                    <!-- Fusion gene -->
                    {% if report_data.fusion_unknown.data %}
                    <h4 class="variant-type">- Fusion gene{% if report_data.fusion_unknown.highlight %}: {{ report_data.fusion_unknown.highlight }}{% endif %}</h4>
                    <table class="data-table full-width" border="1" id="fusion-unknown-table">
                        <tr>
                            <th>GENE FUSION</th>
                            <th>BREAKPOINT 1</th>
                            <th>BREAKPOINT 2</th>
                            <th>FUSION SUPPORTING READS</th>
                        </tr>
                        {% for row in report_data.fusion_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- Fusion gene<span class="none-text">: None</span></h4>
                    {% endif %}
                    
                    <!-- Copy number variation -->
                    {% if report_data.cnv_unknown.data %}
                    <h4 class="variant-type">- Copy number variation{% if report_data.cnv_unknown.highlight %}: {{ report_data.cnv_unknown.highlight }}{% endif %}</h4>
                    <table class="data-table full-width" border="1" id="cnv-unknown-table">
                        <tr>
                            <th>GENE</th>
                            <th>LOCATION</th>
                            <th>FOLD CHANGE</th>
                            <th>ESTIMATED COPY NUMBER</th>
                        </tr>
                        {% for row in report_data.cnv_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- Copy number variation<span class="none-text">: None</span></h4>
                    {% endif %}
                    
                    <!-- Large rearrangements in BRCA1/2 -->
                    {% if report_data.lr_brca_unknown.data %}
                    <h4 class="variant-type">- Large rearrangements in BRCA1/2{% if report_data.lr_brca_unknown.highlight %}: {{ report_data.lr_brca_unknown.highlight }}{% endif %}</h4>
                    <table class="data-table full-width" border="1" id="lr-brca-unknown-table">
                        <tr>
                            <th>GENE</th>
                            <th>LOCATION</th>
                            <th>AFFECTED EXON</th>
                            <th>FOLD CHANGE</th>
                            <th>ESTIMATED COPY NUMBER</th>
                        </tr>
                        {% for row in report_data.lr_brca_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- Large rearrangements in BRCA1/2<span class="none-text">: None</span></h4>
                    {% endif %}
                    
                    <!-- Splice variant -->
                    {% if report_data.splice_unknown.data %}
                    <h4 class="variant-type">- Splice variant{% if report_data.splice_unknown.highlight %}: {{ report_data.splice_unknown.highlight }}{% endif %}</h4>
                    <table class="data-table full-width" border="1" id="splice-unknown-table">
                        <tr>
                            <th>GENE</th>
                            <th>AFFECTED EXON</th>
                            <th>BREAKPOINT 1</th>
                            <th>BREAKPOINT 2</th>
                            <th>SPLICE SUPPORTING READS</th>
                        </tr>
                        {% for row in report_data.splice_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- Splice variant<span class="none-text">: None</span></h4>
                    {% endif %}
                    
                    <!-- 3. Failed gene -->
                    <h3 class="result-title">3. Failed gene: <span id="failed-gene">{{ report_data.failed_gene }}</span></h3>
                    
                    <!-- Comment -->
                    <div class="section" style="margin-top: 20px;">
                        <h2 class="section-title">â–£ Comment</h2>
                        <div class="comment-section">
                            <div id="comments" class="comment-box">
                                {% if report_data.comments %}
                                    <div class="comment-text">
                                        {% for comment in report_data.comments %}
                                            <p>{{ comment }}</p>
                                            {% if not loop.last %}<br>{% endif %}
                                        {% endfor %}
                                    </div>
                                    <br>
                                {% endif %}
                                <p>ë³¸ ê°€ì´ë“œëŠ” í™˜ìì˜ ì•”ê³¼ ê´€ë ¨ëœ ë¶„ì ì´ìƒ(COSMIC Cancer e-Journals) íŒë‹¨ ê·¼ê±°ì™€ ì°¸ê³ ë¬¸í—Œì„ ì œê³µí•©ë‹ˆë‹¤. ASCO ê°€ì´ë“œë¼ì¸ì— ë”°ë¼ Strong Clinical Significance (Tier I), Unknown Clinical Significance (Tier II), Benign or Likely Benignì„ íŒë³„í•˜ì—¬ ìœ ì „ì ë³€ì´ì˜ ì„ìƒì  ì¤‘ìš”ë„ë¥¼ í‰ê°€í•˜ì˜€ìŠµë‹ˆë‹¤. Standards and Guidelines for the Interpretation and Reporting of Sequence Variants in Cancer: A Joint Consensus Recommendation of the Association for Molecular Pathology, American Society of Clinical Oncology, and College of American Pathologists. J Mol Diagn 2017; 19(1):4-23.</p>
                            </div>
                            
                            <!-- ì¶”ê°€ ì•ˆë‚´ì‚¬í•­ -->
                            <div class="additional-info">
                                <p>â€¢ ë³¸ ê²€ì‚¬ì˜ raw data (BAM, FASTQ, VCF) íŒŒì¼ì€ ë¶„ì ë³‘ë¦¬ ê²€ì‚¬ì‹¤ ë‚´ ë³‘ë¦¬ê³¼ ì„œë²„ ì»´í“¨í„°ì—ì„œ ë³´ê´€, ê´€ë¦¬ë˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
                                <p>â€¢ ë³¸ ê²€ì‚¬ì˜ ê²°ê³¼ëŠ” ê²€ì²´ì— í¬í•¨ëœ ì •ìƒì„¸í¬ì™€ ì•”ì„¸í¬ì˜ ë¹„ìœ¨ì— ë”°ë¼ ìœ„ìŒì„±ì˜ ê²°ê³¼ë¥¼ ë°°ì œ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Page 2: ê²€ì‚¬ì •ë³´ë¶€í„° Specificationê¹Œì§€ -->
        <div class="a4-page page-2">
            <div class="page-border">
                <div class="page-2-content">
                    <!-- ê²€ì‚¬ì •ë³´ -->
                    <div class="section">
                        <h2 class="section-title">â–£ ê²€ì‚¬ì •ë³´</h2>
                        <div class="info-section">
                            <p><span class="info-label">ê²€ì‚¬ì‹œì•½ :</span> {% if report_data.panel_type == 'GE' %}AllPrep DNA/RNA FFPE Kit (50) [Qiagen], TruSightâ„¢ Oncology 500 kit [Illumina]{% else %}AllPrep DNA/RNA FFPE Kit (50) [Qiagen], TruSightâ„¢ Oncology 500 kit [Illumina], TruSightâ„¢ RNA Fusion Panel [Illumina]{% endif %}</p>
                            <p><span class="info-label">ê²€ì‚¬ë°©ë²• :</span> NGS targeted DNA/RNA sequencing (Library : Hybrid capture)</p>
                            <p><span class="info-label">ê²€ì‚¬ê¸°ê¸° :</span> {{ report_data.diagnostic_info.ê²€ì‚¬ê¸°ê¸° }}</p>
                            <p><span class="info-label">Reference genome :</span> Homo_sapiens/ UCSC/ hg19</p>
                        </div>
                    </div>
                    
                    <!-- Filter history -->
                    <div class="section">
                        <h2 class="section-title">â–£ Filter history</h2>
                        <div class="info-section">
                            <p><span class="info-label">Include :</span> Exonic, Illumina Q.C Filter PASS, Fold change &lt;0.5 or &gt;1.5</p>
                            <p><span class="info-label">Exclude :</span> Synonymous, VAF &lt;3%, total depth &lt;100, refer depth=0</p>
                        </div>
                    </div>
                    
                    <!-- DNA, RNA -->
                    <div class="section">
                        <h2 class="section-title">â–£ DNA, RNA <span class="small-text">(Qubit ë†ë„)</span></h2>
                        <div class="info-section">
                            <p><span class="info-label">DNA (ng/ul) :</span> {{ report_data.drna_qubit.DNA }} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="info-label">RNA (ng/ul) :</span> {{ report_data.drna_qubit.RNA }}</p>
                        </div>
                    </div>
                    
                    <!-- Q.C -->
                    <div class="section">
                        <h2 class="section-title">â–£ Q.C</h2>
                        <div class="info-section">
                            <div class="qc-simple">
                                <div class="qc-header">
                                    <span class="qc-col-tight">Metric (UOM)</span>
                                    <span class="qc-col-tight">LSL Guideline</span>
                                    <span class="qc-col-tight">Value</span>
                                </div>
                                {% if report_data.qc.data %}
                                    {% for row in report_data.qc.data %}
                                        <div class="qc-row-simple">
                                            <span class="qc-col-tight">{{ row[0] }}</span>
                                            <span class="qc-col-tight">{{ row[1] }}</span>
                                            <span class="qc-col-tight">{{ row[2] }}</span>
                                        </div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Analysis Program -->
                    <div class="section">
                        <h2 class="section-title">â–£ Analysis Program</h2>
                        <div class="info-section">
                            <p>DRAGEN TSO500 ( Workflow Version : 2.5.2 )</p>
                        </div>
                    </div>
                    
                    <!-- Specification -->
                    <div class="section">
                        <h2 class="section-title">â–£ Specification</h2>
                        <div class="specification-box">
                            <img src="/static/images/{% if report_data.panel_type == 'GE' %}GE_Specification.png{% else %}SA_Specification.png{% endif %}" alt="Specification">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Page 3: Gene Content -->
        {% if report_data.panel_type == 'GE' %}
        <!-- GE: í•œ í˜ì´ì§€ì— Gene Content + Footer -->
        <div class="a4-page page-3">
            <div class="page-border">
                <div class="page-3-content">
                    <div class="gene-content-wrapper">
                        <div class="section">
                            <h2 class="section-title">â–£ Gene Content in the TruSight Oncology 500 panel Assay</h2>
                            <div class="gene-content-box">
                                <img src="/static/images/GE_Gene_Content_DRNA.png" alt="Gene Content">
                            </div>
                        </div>
                    </div>
                    
                    <!-- ë§ˆì§€ë§‰ í˜ì´ì§€: ì‚¬ìš©ì ì •ë³´ + Footer -->
                    <div class="page-footer-wrapper">
                        <!-- ì‚¬ìš©ì ì •ë³´ (ë§ˆì§€ë§‰ í˜ì´ì§€ì—ë§Œ) -->
                        <div class="user-info-section">
                            <div class="user-info-divider"></div>
                            <div class="user-info-container">
                                <div class="user-info-number-row">
                                    <table class="user-number-table">
                                        <tr>
                                            <td class="user-number-label">ë¶„ì ì ‘ìˆ˜ ë²ˆí˜¸</td>
                                            <td class="user-number-value">{{ report_data.diagnosis_user['ë¶„ìì ‘ìˆ˜ë²ˆí˜¸'] }}</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="user-info-tested-row">
                                    <span class="user-tested"><strong>Tested by:</strong> {{ report_data.diagnosis_user['Tested by'] }}</span>
                                    <span class="user-analyzed"><strong>Analyzed by:</strong> {{ report_data.diagnosis_user['Analyzed by'] }}</span>
                                </div>
                                <div class="user-info-signed-row">
                                    <span class="user-signed"><strong>Signed by:</strong> {{ report_data.diagnosis_user['Signed by'] }}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Footer (ë¡œê³ ì™€ ê²€ì‚¬ê¸°ê´€ ì •ë³´ë§Œ) -->
                        <div class="report-footer">
                            <div class="footer-container">
                                <div class="footer-row">
                                    <div class="footer-left">
                                        <div class="footer-org">ê²€ì‚¬ê¸°ê´€ : ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ ë¶„ìë³‘ë¦¬ ê²€ì‚¬ì‹¤</div>
                                        <div class="footer-address">ì„œìš¸ì‹œ ì„œëŒ€ë¬¸êµ¬ ì—°ì„¸ë¡œ 50-1 (ì‹ ì´Œë™ 134) ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ Tel: 02-2228-2625</div>
                                    </div>
                                    <div class="footer-right">
                                        <img src="/static/images/Sev_Logo.png" alt="ì„¸ë¸Œë€ìŠ¤ë³‘ì›">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <!-- SA: DNA í˜ì´ì§€ -->
        <div class="a4-page page-3">
            <div class="page-border">
                <div class="page-3-content">
                    <div class="gene-content-wrapper">
                        <div class="section">
                            <h2 class="section-title">â–£ Gene Content in the NGS Sarcoma Panel Assay [DNA]</h2>
                            <div class="gene-content-box">
                                <img src="/static/images/SA_Gene_Content_DNA.png" alt="Gene Content DNA">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- SA: RNA í˜ì´ì§€ + Footer -->
        <div class="a4-page page-4">
            <div class="page-border">
                <div class="page-4-content">
                    <div class="gene-content-wrapper">
                        <div class="section">
                            <h2 class="section-title">â–£ Gene Content in the NGS Sarcoma Panel Assay [RNA]</h2>
                            <div class="gene-content-box">
                                <img src="/static/images/SA_Gene_Content_RNA.png" alt="Gene Content RNA">
                            </div>
                        </div>
                    </div>
                    
                    <!-- ë§ˆì§€ë§‰ í˜ì´ì§€: ì‚¬ìš©ì ì •ë³´ + Footer -->
                    <div class="page-footer-wrapper">
                        <!-- ì‚¬ìš©ì ì •ë³´ (ë§ˆì§€ë§‰ í˜ì´ì§€ì—ë§Œ) -->
                        <div class="user-info-section">
                            <div class="user-info-divider"></div>
                            <div class="user-info-container">
                                <div class="user-info-number-row">
                                    <table class="user-number-table">
                                        <tr>
                                            <td class="user-number-label">ë¶„ì ì ‘ìˆ˜ ë²ˆí˜¸</td>
                                            <td class="user-number-value">{{ report_data.diagnosis_user['ë¶„ìì ‘ìˆ˜ë²ˆí˜¸'] }}</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="user-info-tested-row">
                                    <span class="user-tested"><strong>Tested by:</strong> {{ report_data.diagnosis_user['Tested by'] }}</span>
                                    <span class="user-analyzed"><strong>Analyzed by:</strong> {{ report_data.diagnosis_user['Analyzed by'] }}</span>
                                </div>
                                <div class="user-info-signed-row">
                                    <span class="user-signed"><strong>Signed by:</strong> {{ report_data.diagnosis_user['Signed by'] }}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Footer (ë¡œê³ ì™€ ê²€ì‚¬ê¸°ê´€ ì •ë³´ë§Œ) -->
                        <div class="report-footer">
                            <div class="footer-container">
                                <div class="footer-row">
                                    <div class="footer-left">
                                        <div class="footer-org">ê²€ì‚¬ê¸°ê´€ : ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ ë¶„ìë³‘ë¦¬ ê²€ì‚¬ì‹¤</div>
                                        <div class="footer-address">ì„œìš¸ì‹œ ì„œëŒ€ë¬¸êµ¬ ì—°ì„¸ë¡œ 50-1 (ì‹ ì´Œë™ 134) ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ Tel: 02-2228-2625</div>
                                    </div>
                                    <div class="footer-right">
                                        <img src="/static/images/Sev_Logo.png" alt="ì„¸ë¸Œë€ìŠ¤ë³‘ì›">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- ë¶„í• ëœ CNV í…Œì´ë¸”ì„ ìœ„í•œ ì¶”ê°€ í˜ì´ì§€ (í•„ìš”ì‹œ ë™ì  ìƒì„±) -->
    <div class="a4-page page-cnv-continued" id="cnv-continued-page" style="display: none;">
        <div class="page-border">
            <div class="report-content">
                <!-- CNV ë¶„í•  í…Œì´ë¸” (2/2) -->
                <div id="cnv-continued-section">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                </div>
            </div>
            
            <!-- ì²« í˜ì´ì§€ í•˜ë‹¨ ê³ ì • ì»¨í…ì¸  ë³µì‚¬ -->
            <div class="page-bottom-fixed">
                <!-- Other Biomarkers -->
                <div class="section">
                    <h4 class="variant-type">- Other Biomarkers</h4>
                    <table class="biomarkers-table full-width" border="1">
                        <tr>
                            <th>Estimated Tumor Mutation Burden (TMB)</th>
                            <th>Microsatellite Instability (MSI) (% Unstable MSI Sites)</th>
                        </tr>
                        <tr>
                            <td>{{ report_data.biomarkers.TMB }}</td>
                            <td>{{ report_data.biomarkers.MSI }}</td>
                        </tr>
                    </table>
                </div>
                
                <!-- Footer (ë¡œê³ ì™€ ê²€ì‚¬ê¸°ê´€ ì •ë³´ë§Œ) -->
                <div class="report-footer">
                    <div class="footer-container">
                        <div class="footer-row">
                            <div class="footer-left">
                                <div class="footer-org">ê²€ì‚¬ê¸°ê´€ : ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ ë¶„ìë³‘ë¦¬ ê²€ì‚¬ì‹¤</div>
                                <div class="footer-address">ì„œìš¸ì‹œ ì„œëŒ€ë¬¸êµ¬ ì—°ì„¸ë¡œ 50-1 (ì‹ ì´Œë™ 134) ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ Tel: 02-2228-2625</div>
                            </div>
                            <div class="footer-right">
                                <img src="/static/images/Sev_Logo.png" alt="ì„¸ë¸Œë€ìŠ¤ë³‘ì›">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ê²€ì²´ IDë¥¼ JavaScriptë¡œ ì „ë‹¬
        window.specimenId = '{{ specimen_id }}';
        
        // ì •í™•í•œ ì½˜í…ì¸  ë°°ì¹˜ ë° í•„ìš”ì‹œë§Œ ë¶„í• 
        function checkAndSplitTables() {
            const page1Content = document.querySelector('.page-1 .report-content');
            const otherBiomarkers = document.querySelector('.page-bottom-fixed');
            
            // Other Biomarkersê°€ ë‹¤ë¥¸ ì½˜í…ì¸ ì™€ ê²©ì¹˜ëŠ”ì§€ ì²´í¬
            const otherBiomarkersRect = otherBiomarkers.getBoundingClientRect();
            
            // ëª¨ë“  splittable-sectionë“¤ì„ ì²´í¬
            const splittableSections = document.querySelectorAll('.splittable-section');
            
            for (let section of splittableSections) {
                const sectionRect = section.getBoundingClientRect();
                
                // ì„¹ì…˜ì´ Other Biomarkersì™€ ê²©ì¹˜ëŠ”ì§€ ì²´í¬
                if (sectionRect.bottom > otherBiomarkersRect.top - 20) { // 20px ì—¬ìœ ê³µê°„
                    console.log(`Section ${section.dataset.sectionName} overlaps with Other Biomarkers`);
                    
                    // ì´ ì„¹ì…˜ë§Œ ì²˜ë¦¬í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” ê·¸ëŒ€ë¡œ ë‘˜ê¸°
                    handleOverlappingSection(section);
                    break; // ì²« ë²ˆì§¸ ê²©ì¹˜ëŠ” ì„¹ì…˜ë§Œ ì²˜ë¦¬
                }
            }
        }
        
        function handleOverlappingSection(section) {
            const sectionName = section.dataset.sectionName;
            const tableType = section.dataset.tableType;
            const table = section.querySelector('table');
            const dataRows = table.querySelectorAll('tbody tr');
            
            console.log(`Handling overlapping section: ${sectionName} with ${dataRows.length} rows`);
            
            // í–‰ì´ ì¶©ë¶„íˆ ë§ìœ¼ë©´ ë¶„í• , ì ìœ¼ë©´ ì „ì²´ ì´ë™
            if (dataRows.length > 3) {
                // í…Œì´ë¸” ë¶„í• 
                splitSingleTable(section, dataRows, sectionName, tableType);
            } else {
                // ì „ì²´ ì„¹ì…˜ì„ ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™
                moveWholeSection(section);
            }
        }
        
        function splitSingleTable(section, dataRows, sectionName, tableType) {
            // í…Œì´ë¸”ì„ ë°˜ìœ¼ë¡œ ë‚˜ëˆ„ê¸°
            const splitPoint = Math.ceil(dataRows.length / 2);
            
            console.log(`Splitting table ${sectionName}: ${splitPoint} rows on page 1, ${dataRows.length - splitPoint} rows on page 2`);
            
            // ì²« ë²ˆì§¸ í˜ì´ì§€ ì œëª©ì— (1/2) ì¶”ê°€
            const titleElement = section.querySelector('.variant-type');
            if (titleElement && !titleElement.textContent.includes('(1/2)')) {
                const titleText = titleElement.innerHTML;
                titleElement.innerHTML = titleText.replace(`- ${sectionName}`, `- ${sectionName} (1/2)`);
            }
            
            // ë‹¤ìŒ í˜ì´ì§€ì— ë‚˜ë¨¸ì§€ í…Œì´ë¸” + ê·¸ ë‹¤ìŒ ëª¨ë“  ì½˜í…ì¸  ì¶”ê°€
            createContinuedPageWithRemainingContent(section, dataRows, splitPoint, sectionName, tableType);
            
            // ì²« ë²ˆì§¸ í˜ì´ì§€ì—ì„œ ì´ˆê³¼í•˜ëŠ” í–‰ë“¤ ì œê±°
            for (let i = splitPoint; i < dataRows.length; i++) {
                dataRows[i].remove();
            }
        }
        
        function moveWholeSection(section) {
            console.log(`Moving whole section: ${section.dataset.sectionName}`);
            
            // í˜„ì¬ ì„¹ì…˜ë¶€í„° ëê¹Œì§€ì˜ ëª¨ë“  ì½˜í…ì¸ ë¥¼ ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™
            const allRemainingContent = [];
            let currentElement = section;
            
            // í˜„ì¬ ìš”ì†Œë¶€í„° ëê¹Œì§€ ëª¨ë“  í˜•ì œ ìš”ì†Œë“¤ì„ ìˆ˜ì§‘
            while (currentElement) {
                if (currentElement.classList && 
                    (currentElement.classList.contains('section') || 
                     currentElement.classList.contains('splittable-section') ||
                     currentElement.tagName === 'H3')) {
                    allRemainingContent.push(currentElement);
                }
                currentElement = currentElement.nextElementSibling;
            }
            
            moveContentToNewPage(allRemainingContent);
        }
        
        function moveContentToNewPage(sections) {
            // ìƒˆë¡œìš´ í˜ì´ì§€ ìƒì„±
            const page1 = document.querySelector('.page-1');
            const continuedPage = document.createElement('div');
            continuedPage.className = 'a4-page page-content-continued';
            
            // ì„¹ì…˜ë“¤ì˜ HTML ì¶”ì¶œ
            let sectionsHTML = '';
            sections.forEach(section => {
                sectionsHTML += section.outerHTML;
                if (section.parentNode) {
                    section.parentNode.removeChild(section);
                }
            });
            
            continuedPage.innerHTML = `
                <div class="page-border">
                    <div class="report-content">
                        ${sectionsHTML}
                    </div>
                </div>
            `;
            
            // ì²« ë²ˆì§¸ í˜ì´ì§€ ë‹¤ìŒì— ì‚½ì…
            page1.parentNode.insertBefore(continuedPage, page1.nextSibling);
            
            console.log('Moved content to new page');
        }
        
        function createContinuedPageWithRemainingContent(originalSection, allRows, splitPoint, sectionName, tableType) {
            const page1 = document.querySelector('.page-1');
            
            // ë¶„í• ëœ í…Œì´ë¸” HTML ìƒì„±
            const splitTableHTML = createSplitTableHTML(originalSection, allRows, splitPoint, sectionName, tableType);
            
            // í˜„ì¬ ì„¹ì…˜ ë‹¤ìŒë¶€í„° ëê¹Œì§€ì˜ ëª¨ë“  ì½˜í…ì¸  ìˆ˜ì§‘
            const allRemainingContent = [];
            let currentElement = originalSection.nextElementSibling;
            
            while (currentElement) {
                if (currentElement.classList && 
                    (currentElement.classList.contains('section') || 
                     currentElement.classList.contains('splittable-section') ||
                     currentElement.tagName === 'H3')) {
                    allRemainingContent.push(currentElement);
                }
                currentElement = currentElement.nextElementSibling;
            }
            
            // ë‚˜ë¨¸ì§€ ì½˜í…ì¸  HTML ìƒì„±
            let remainingSectionsHTML = '';
            allRemainingContent.forEach(element => {
                remainingSectionsHTML += element.outerHTML;
                if (element.parentNode) {
                    element.parentNode.removeChild(element);
                }
            });
            
            // ìƒˆë¡œìš´ í˜ì´ì§€ ìƒì„±
            const continuedPage = document.createElement('div');
            continuedPage.className = 'a4-page page-content-continued';
            
            continuedPage.innerHTML = `
                <div class="page-border">
                    <div class="report-content">
                        ${splitTableHTML}
                        ${remainingSectionsHTML}
                    </div>
                </div>
            `;
            
            // ì²« ë²ˆì§¸ í˜ì´ì§€ ë‹¤ìŒì— ì‚½ì…
            page1.parentNode.insertBefore(continuedPage, page1.nextSibling);
            
            console.log(`${sectionName} table split and all remaining content moved successfully`);
        }
        
        function createSplitTableHTML(originalSection, allRows, splitPoint, sectionName, tableType) {
            // ì›ë³¸ ì œëª©ì—ì„œ highlight ì •ë³´ ì¶”ì¶œ
            const originalTitle = originalSection.querySelector('.variant-type');
            const highlightElement = originalTitle ? originalTitle.querySelector('.clinical-highlight') : null;
            const highlightText = highlightElement ? highlightElement.outerHTML : '';
            
            // í…Œì´ë¸” í—¤ë” ì¶”ì¶œ
            const originalTable = originalSection.querySelector('table');
            const originalHeader = originalTable.querySelector('thead tr');
            let headerHTML = '';
            if (originalHeader) {
                headerHTML = originalHeader.innerHTML;
            }
            
            // ë‚˜ë¨¸ì§€ í–‰ë“¤ HTML ìƒì„±
            let rowsHTML = '';
            for (let i = splitPoint; i < allRows.length; i++) {
                rowsHTML += allRows[i].outerHTML;
            }
            
            return `
                <div class="continued-section">
                    <h4 class="variant-type">- ${sectionName} (2/2)${highlightText}</h4>
                    <table class="data-table full-width split-table-continued ${tableType}-split" border="1">
                        <thead>
                            <tr>${headerHTML}</tr>
                        </thead>
                        <tbody>
                            ${rowsHTML}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        // í˜ì´ì§€ ë¡œë“œ í›„ í…Œì´ë¸” ë¶„í•  ì²´í¬
        document.addEventListener('DOMContentLoaded', function() {
            // ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ì–´ ë ˆì´ì•„ì›ƒì´ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹¤í–‰
            setTimeout(checkAndSplitTables, 500); // ì§€ì—° ì‹œê°„ ì¦ê°€
        });
        
        // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì‹œì—ë„ ì²´í¬
        window.addEventListener('resize', function() {
            setTimeout(checkAndSplitTables, 300);
        });
        
        // ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ í›„ì—ë„ ì²´í¬
        window.addEventListener('load', function() {
            setTimeout(checkAndSplitTables, 500);
        });
    </script>
    <script src="/static/js/script.js"></script>
    
    <!-- PDF ë‹¤ìš´ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="/static/js/report.js"></script>
</body>
</html>
