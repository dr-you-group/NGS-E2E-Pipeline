<!DOCTYPE html>
<html lang="ko">
{% macro render_highlight(highlight_data) %}
{% if highlight_data %}
:
{% for segment in highlight_data %}
{% if segment.style == 'italic' %}
<i>{{ segment.text }}</i>
{% else %}
{{ segment.text }}
{% endif %}
{% endfor %}
{% endif %}
{% endmacro %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NGS Report</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <!-- Critical CSS for Loading Overlay -->
    <style>
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #ffffff;
            z-index: 99999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #333;
            /* Dark grey for professional look */
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        .loading-text {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 16px;
            color: #333;
            font-weight: 500;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        body.loaded #loading-overlay {
            opacity: 0;
            visibility: hidden;
        }
    </style>
    <link rel="stylesheet" href="/static/css/styles.css?v=28">
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">ë¦¬í¬íŠ¸ ìƒì„± ì¤‘...</div>
    </div>
    <div class="container">
        <!-- PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
        <div class="report-controls">
            <button id="pdf-download-btn" class="report-btn pdf">
                ğŸ“„ PDF ë‹¤ìš´ë¡œë“œ
            </button>
            <button id="ppt-download-btn" class="report-btn ppt" onclick="downloadPPT('{{ specimen_id }}')">
                ğŸ“‘ PPT ë‹¤ìš´ë¡œë“œ
            </button>
        </div>
        <!-- ë””ë²„ê·¸ ì •ë³´ (ê°œë°œ ì¤‘ì—ë§Œ ì‚¬ìš©) -->
        {% if debug %}
        <div class="debug-info">
            <h3>ë””ë²„ê·¸ ì •ë³´</h3>
            <pre>{{ report_data | tojson(indent=4) }}</pre>
        </div>
        {% endif %}

        <!-- Page 1: ê²€ì²´ì •ë³´ + ì¼ë¶€ ê²€ì‚¬ê²°ê³¼ + Other biomarkers + Footer -->
        <div class="a4-page page-1">
            <div class="page-border">
                <div style="position: relative; height: 100%;">
                    <div class="report-content">
                        <!-- ë³´ê³ ì„œ í—¤ë” -->
                        <div class="report-header">
                            <h1>NGS Panel Level II Analysis Report</h1>
                        </div>

                        <!-- ê²€ì²´ ì •ë³´ -->
                        <div class="section">
                            <h2 class="section-title">â–£ ê²€ì²´ ì •ë³´</h2>
                            <table class="info-table full-width">
                                <tr>
                                    <th>ê²€ì²´ ì •ë³´</th>
                                    <th>ì„±ë³„</th>
                                    <th>ë‚˜ì´</th>
                                    <th>Unit NO.</th>
                                    <th>í™˜ìëª…</th>
                                    <th>ì±„ì·¨ ì¥ê¸°</th>
                                    <th>ì›ë°œ ì¥ê¸°</th>
                                    <th colspan="2">ì§„ë‹¨</th>
                                </tr>
                                <tr>
                                    <td>{{ report_data.clinical_info['ê²€ì²´ ì •ë³´'] }}</td>
                                    <td>{{ report_data.clinical_info.ì„±ë³„ }}</td>
                                    <td>{{ report_data.clinical_info.ë‚˜ì´ }}</td>
                                    <td>{{ report_data.clinical_info['Unit NO.'] }}</td>
                                    <td>{{ report_data.clinical_info.í™˜ìëª… }}</td>
                                    <td>{{ report_data.clinical_info['ì±„ì·¨ ì¥ê¸°'] }}</td>
                                    <td>{{ report_data.clinical_info['ì›ë°œ ì¥ê¸°'] }}</td>
                                    <td colspan="2">{{ report_data.clinical_info.ì§„ë‹¨ }}</td>
                                </tr>
                                <tr>
                                    <th>ì˜ë¢°ì˜</th>
                                    <th colspan="3" style="width: 20%;">ì˜ë¢°ì˜ ì†Œì†</th>
                                    <th>ê²€ì²´ ìœ í˜•</th>
                                    <th colspan="2">ê²€ì²´ì˜ ì ì ˆì„±ì—¬ë¶€</th>
                                    <th>ê²€ì²´ì ‘ìˆ˜ì¼</th>
                                    <th>ê²°ê³¼ë³´ê³ ì¼</th>
                                </tr>
                                <tr>
                                    <td>{{ report_data.clinical_info['ì˜ë¢°ì˜'] }}</td>
                                    <td colspan="3" style="width: 20%;">{{ report_data.clinical_info['ì˜ë¢°ì˜ ì†Œì†'] }}</td>
                                    <td>{{ report_data.clinical_info['ê²€ì²´ ìœ í˜•'] }}</td>
                                    <td colspan="2">{{ report_data.clinical_info['ê²€ì²´ì˜ ì ì ˆì„±ì—¬ë¶€'] }}</td>
                                    <td>{{ report_data.clinical_info['ê²€ì²´ì ‘ìˆ˜ì¼'] }}</td>
                                    <td>{{ report_data.clinical_info.get('ê²°ê³¼ë³´ê³ ì¼', 'N/A') }}</td>
                                </tr>
                            </table>
                        </div>

                        <!-- ê²€ì‚¬ê²°ê³¼ -->
                        <div class="section">
                            <h2 class="section-title">â–£ ê²€ì‚¬ê²°ê³¼</h2>

                            <!-- 1. Variants of clinical significance -->
                            <h3 class="result-title">1. <span class="clinical-highlight">Variants of clinical
                                    significance</span></h3>

                            <!-- SNVs & Indels (ë¶„í•  ê°€ëŠ¥) -->
                            {% if report_data.snv_clinical.data %}
                            <div id="snv-clinical-section" class="splittable-section" data-section-name="SNVs & Indels"
                                data-table-type="clinical" {% if report_data.snv_clinical.split_at %}
                                data-split-at="{{ report_data.snv_clinical.split_at }}" {% endif %}>
                                <h4 class="variant-type snv-title">- SNVs & Indels
                                    <span class="clinical-highlight">
                                        {{ render_highlight(report_data.snv_clinical.highlight) }}
                                    </span>
                                </h4>
                                <table class="data-table full-width" id="snv-clinical-table">
                                    <thead>
                                        <tr>
                                            <th>GENE</th>
                                            <th>MUTATION TYPE</th>
                                            <th>AA CHANGE</th>
                                            <th>VAF (%)</th>
                                            <th>HGVSc</th>
                                            <th>HGVSp</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in report_data.snv_clinical.data %}
                                        <tr class="snv-data-row">
                                            {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <h4 class="variant-type">- SNVs & Indels<span class="none-text">: None</span></h4>
                            {% endif %}

                            <!-- Fusion gene (ë¶„í•  ê°€ëŠ¥) -->
                            {% if report_data.fusion_clinical.data %}
                            <div id="fusion-clinical-section" class="splittable-section" data-section-name="Fusion gene"
                                data-table-type="clinical">
                                <h4 class="variant-type fusion-title">- Fusion genes
                                    <span class="clinical-highlight">
                                        {{ render_highlight(report_data.fusion_clinical.highlight) }}
                                    </span>
                                </h4>
                                <table class="data-table full-width" id="fusion-clinical-table">
                                    <thead>
                                        <tr>
                                            <th>GENE FUSION</th>
                                            <th>BREAKPOINT 1</th>
                                            <th>BREAKPOINT 2</th>
                                            <th>FUSION SUPPORTING READS</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in report_data.fusion_clinical.data %}
                                        <tr class="fusion-data-row">
                                            {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <h4 class="variant-type">- Fusion gene<span class="none-text">: None</span></h4>
                            {% endif %}

                            <!-- Copy number variation (ë¶„í•  ê°€ëŠ¥) -->
                            {% if report_data.cnv_clinical.data %}
                            <div id="cnv-clinical-section" class="splittable-section"
                                data-section-name="Copy number variation" {% if report_data.cnv_clinical.split_at %}
                                data-split-at="{{ report_data.cnv_clinical.split_at }}" {% endif %}>
                                <h4 class="variant-type cnv-title">- Copy number variation
                                    <span class="clinical-highlight">
                                        {{ render_highlight(report_data.cnv_clinical.highlight) }}
                                    </span>
                                </h4>
                                <table class="data-table full-width" id="cnv-clinical-table">
                                    <thead>
                                        <tr>
                                            <th>GENE</th>
                                            <th>LOCATION</th>
                                            <th>FOLD CHANGE</th>
                                            <th>ESTIMATED COPY NUMBER</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in report_data.cnv_clinical.data %}
                                        <tr class="cnv-data-row">
                                            {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <h4 class="variant-type">- Copy number variation<span class="none-text">: None</span></h4>
                            {% endif %}

                            <!-- Large rearrangements in BRCA1/2 (ë¶„í•  ê°€ëŠ¥) -->
                            {% if report_data.lr_brca_clinical.data %}
                            <div id="lr-brca-clinical-section" class="splittable-section"
                                data-section-name="Large rearrangements in BRCA1/2" data-table-type="clinical">
                                <h4 class="variant-type lr-brca-title">- Large rearrangements in BRCA1/2
                                    <span class="clinical-highlight">
                                        {{ render_highlight(report_data.lr_brca_clinical.highlight) }}
                                    </span>
                                </h4>
                                <table class="data-table full-width" id="lr-brca-clinical-table">
                                    <thead>
                                        <tr>
                                            <th>GENE</th>
                                            <th>LOCATION</th>
                                            <th>AFFECTED EXON</th>
                                            <th>FOLD CHANGE</th>
                                            <th>ESTIMATED COPY NUMBER</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in report_data.lr_brca_clinical.data %}
                                        <tr class="lr-brca-data-row">
                                            {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <h4 class="variant-type">- Large rearrangements in BRCA1/2<span class="none-text">:
                                    None</span></h4>
                            {% endif %}

                            <!-- Splice variant (ë¶„í•  ê°€ëŠ¥) -->
                            {% if report_data.splice_clinical.data %}
                            <div id="splice-clinical-section" class="splittable-section"
                                data-section-name="Splice variant" data-table-type="clinical">
                                <h4 class="variant-type splice-title">- Splice variant
                                    <span class="clinical-highlight">
                                        {{ render_highlight(report_data.splice_clinical.highlight) }}
                                    </span>
                                </h4>
                                <table class="data-table full-width" id="splice-clinical-table">
                                    <thead>
                                        <tr>
                                            <th>GENE</th>
                                            <th>AFFECTED EXON</th>
                                            <th>BREAKPOINT 1</th>
                                            <th>BREAKPOINT 2</th>
                                            <th>SPLICE SUPPORTING READS</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in report_data.splice_clinical.data %}
                                        <tr class="splice-data-row">
                                            {% for cell in row %}
                                            <td>{{ cell }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <h4 class="variant-type">- Splice variant<span class="none-text">: None</span></h4>
                            {% endif %}
                        </div>
                    </div>

                    <!-- ì²« í˜ì´ì§€ í•˜ë‹¨ ê³ ì • ì»¨í…ì¸  -->
                    <div class="page-bottom-fixed">
                        <!-- Other Biomarkers -->
                        <div class="section">
                            <h4 class="variant-type">- Other Biomarkers</h4>
                            <table class="biomarkers-table full-width">
                                <tr>
                                    <th>Estimated Tumor Mutation Burden (TMB)</th>
                                    <th>Microsatellite Instability (MSI) (% Unstable MSI Sites)</th>
                                </tr>
                                <tr>
                                    <td>{{ report_data.biomarkers.TMB }}</td>
                                    <td>{{ report_data.biomarkers.MSI }}</td>
                                </tr>
                            </table>
                        </div>

                        <!-- Footer (ë¡œê³ ì™€ ê²€ì‚¬ê¸°ê´€ ì •ë³´ë§Œ) -->
                        <div class="report-footer">
                            <div class="footer-container">
                                <div class="footer-row">
                                    <div class="footer-left">
                                        <div class="footer-org">ê²€ì‚¬ê¸°ê´€ : ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ ë¶„ìë³‘ë¦¬ ê²€ì‚¬ì‹¤</div>
                                        <div class="footer-address">ì„œìš¸ì‹œ ì„œëŒ€ë¬¸êµ¬ ì—°ì„¸ë¡œ 50-1 (ì‹ ì´Œë™ 134) ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ Tel:
                                            02-2228-2625
                                        </div>
                                    </div>
                                    <div class="footer-right">
                                        <img src="/static/images/Sev_Logo.png" alt="ì„¸ë¸Œë€ìŠ¤ë³‘ì›">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page 1-continued: ê²€ì‚¬ê²°ê³¼ ë‚˜ë¨¸ì§€ ë¶€ë¶„ -->
        <div class="a4-page page-continued page-continued-1">
            <div class="page-border">
                <div class="report-content">
                    <!-- 2. Variants of unknown significance -->
                    <h3 class="result-title">2. Variants of unknown significance</h3>

                    <!-- SNVs & Indels -->
                    {% if report_data.snv_unknown.data %}
                    <h4 class="variant-type">- SNVs & Indels{% if report_data.snv_unknown.highlight %}:
                        {{ report_data.snv_unknown.highlight | safe }}
                        {% endif %}
                    </h4>
                    <table class="data-table full-width" id="snv-unknown-table">
                        <tr>
                            <th>GENE</th>
                            <th>MUTATION TYPE</th>
                            <th>AA CHANGE</th>
                            <th>VAF (%)</th>
                            <th>HGVSc</th>
                            <th>HGVSp</th>
                        </tr>
                        {% for row in report_data.snv_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- SNVs & Indels: <span class="none-text">None</span></h4>
                    {% endif %}

                    <!-- Fusion gene -->
                    {% if report_data.fusion_unknown.data %}
                    <h4 class="variant-type">- Fusion gene{% if report_data.fusion_unknown.highlight %}:
                        {{ report_data.fusion_unknown.highlight | safe }}
                        {% endif %}
                    </h4>
                    <table class="data-table full-width" id="fusion-unknown-table">
                        <tr>
                            <th>GENE FUSION</th>
                            <th>BREAKPOINT 1</th>
                            <th>BREAKPOINT 2</th>
                            <th>FUSION SUPPORTING READS</th>
                        </tr>
                        {% for row in report_data.fusion_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- Fusion gene: <span class="none-text">None</span></h4>
                    {% endif %}

                    <!-- Copy number variation -->
                    {% if report_data.cnv_unknown.data %}
                    <h4 class="variant-type">- Copy number variation{% if report_data.cnv_unknown.highlight %}:
                        {{ report_data.cnv_unknown.highlight }}{% endif %}</h4>
                    <table class="data-table full-width" id="cnv-unknown-table">
                        <tr>
                            <th>GENE</th>
                            <th>LOCATION</th>
                            <th>FOLD CHANGE</th>
                            <th>ESTIMATED COPY NUMBER</th>
                        </tr>
                        {% for row in report_data.cnv_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- Copy number variation<span class="none-text">: None</span></h4>
                    {% endif %}

                    <!-- Large rearrangements in BRCA1/2 -->
                    {% if report_data.lr_brca_unknown.data %}
                    <h4 class="variant-type">- Large rearrangements in BRCA1/2
                        {% if report_data.lr_brca_unknown.highlight %}:
                        {{ report_data.lr_brca_unknown.highlight }}{% endif %}</h4>
                    <table class="data-table full-width" id="lr-brca-unknown-table">
                        <tr>
                            <th>GENE</th>
                            <th>LOCATION</th>
                            <th>AFFECTED EXON</th>
                            <th>FOLD CHANGE</th>
                            <th>ESTIMATED COPY NUMBER</th>
                        </tr>
                        {% for row in report_data.lr_brca_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- Large rearrangements in BRCA1/2<span class="none-text">: None</span></h4>
                    {% endif %}

                    <!-- Splice variant -->
                    {% if report_data.splice_unknown.data %}
                    <h4 class="variant-type">- Splice variant{% if report_data.splice_unknown.highlight %}:
                        {{ report_data.splice_unknown.highlight }}{% endif %}</h4>
                    <table class="data-table full-width" id="splice-unknown-table">
                        <tr>
                            <th>GENE</th>
                            <th>AFFECTED EXON</th>
                            <th>BREAKPOINT 1</th>
                            <th>BREAKPOINT 2</th>
                            <th>SPLICE SUPPORTING READS</th>
                        </tr>
                        {% for row in report_data.splice_unknown.data %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                    {% else %}
                    <h4 class="variant-type">- Splice variant<span class="none-text">: None</span></h4>
                    {% endif %}

                    <!-- 3. Failed gene -->
                    <h3 class="result-title" style="margin-top: 9px;">3. Failed gene: <span id="failed-gene">{{
                            report_data.failed_gene }}</span>
                    </h3>

                    <!-- Comment -->
                    <div class="section" style="margin-top: 15px;">
                        <h2 class="section-title">â–£ Comment</h2>
                        <div id="comments" class="comment-box">
                            {% if report_data.comments %}
                            <div class="comment-text">
                                {% for comment in report_data.comments %}
                                <p>{{ comment }}</p>
                                {% if not loop.last %}<br>{% endif %}
                                {% endfor %}
                            </div>
                            <br>
                            {% endif %}
                            <p>*ë³¸ ê¸°ê´€ì˜ ìœ ì „ì ì •ë³´ ê²€ìƒ‰ ë° í•´ì„ì€ dbSNP, COSMIC, ClinVar, c-bioportal ë“±ì˜ ìœ ì „ì ì •ë³´ê²€ìƒ‰ ì‚¬ì´íŠ¸ë¥¼ ì°¸ê³ ë¡œ í•˜ê³  ìˆìŠµë‹ˆë‹¤.
                                ë˜í•œ, ë°œê²¬ëœ ìœ ì „ì ë³€ì´ì˜ ì„ìƒì  ì˜ë¯¸ì— ëŒ€í•˜ì—¬, ì•„ë˜ ì°¸ê³  ë¬¸í—Œì— ê¸°ë°˜í•œ 4ë‹¨ê³„ ì‹œìŠ¤í…œ (Tier I: Strong clinical
                                significance, Tier II: Potential Clinical significance, Tier III: Unknown Clinical
                                significance, Tier IV: Benign or Likely Benign) ì„ ì ìš©í•˜ì—¬ ë³´ê³ í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë˜í•œ normal cell
                                sequencingì´ ì´ë£¨ì–´ì§€ì§€ ì•Šì•„ ì¼ë¶€ ë³€ì´ì˜ ê²½ìš° germline polymorphismì˜ ê°€ëŠ¥ì„±ì„ ë°°ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>Standards and
                                Guidelines for the Interpretation and Reporting of Sequence Variants in Cancer. A Joint
                                Consensus Recommendation of the Association for Molecular Pathology, American Society of
                                Clinical Oncology and College of American Pathologists. J Mol Diagn. 2017; 19(1):4-23.
                            </p>
                        </div>
                    </div>

                    <!-- ì¶”ê°€ ì•ˆë‚´ì‚¬í•­ (í˜ì´ì§€ í•˜ë‹¨ ê³ ì •) -->
                    <div class="additional-info" style="margin-top: auto; padding-bottom: 5px;">
                        <p>â€¢ ë³¸ ê²€ì‚¬ì˜ raw data (BAM, FASTQ, VCF) íŒŒì¼ì€ ë¶„ì ë³‘ë¦¬ ê²€ì‚¬ì‹¤ ë‚´ ë³‘ë¦¬ê³¼ ì„œë²„ ì»´í“¨í„°ì—ì„œ ë³´ê´€, ê´€ë¦¬ë˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
                        <p>â€¢ ë³¸ ê²€ì‚¬ì˜ ê²°ê³¼ëŠ” ê²€ì²´ì— í¬í•¨ëœ ì •ìƒì„¸í¬ì™€ ì•”ì„¸í¬ì˜ ë¹„ìœ¨ì— ë”°ë¼ ìœ„ìŒì„±ì˜ ê²°ê³¼ë¥¼ ë°°ì œ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page 2: ê²€ì‚¬ì •ë³´ë¶€í„° Specificationê¹Œì§€ -->
        <div class="a4-page page-2">
            <div class="page-border">
                <div class="page-2-content">
                    <!-- ê²€ì‚¬ì •ë³´ -->
                    <div class="section">
                        <h2 class="section-title">â–£ ê²€ì‚¬ì •ë³´</h2>
                        <div class="info-section">
                            <p><span class="info-label">ê²€ì‚¬ì‹œì•½ :</span> {% if report_data.panel_type == 'GE' %}AllPrep
                                DNA/RNA
                                FFPE Kit (50) [Qiagen], TruSightâ„¢ Oncology 500 kit [Illumina]{% else %}AllPrep DNA/RNA
                                FFPE
                                Kit (50) [Qiagen], TruSightâ„¢ Oncology 500 kit [Illumina], TruSightâ„¢ RNA Fusion Panel
                                [Illumina]{% endif %}</p>
                            <p><span class="info-label">ê²€ì‚¬ë°©ë²• :</span> NGS targeted DNA/RNA sequencing (Library : Hybrid
                                capture)</p>
                            <p><span class="info-label">ê²€ì‚¬ê¸°ê¸° :</span> {{ report_data.diagnostic_info.ê²€ì‚¬ê¸°ê¸° }}</p>
                            <p><span class="info-label">Reference genome :</span> Homo_sapiens/ UCSC/ hg19</p>
                        </div>
                    </div>

                    <!-- Filter history -->
                    <div class="section">
                        <h2 class="section-title">â–£ Filter history</h2>
                        <div class="info-section">
                            <p><span class="info-label">Include :</span> Exonic, Illumina Q.C Filter PASS, Fold change
                                &lt;0.5
                                or &gt;1.5</p>
                            <p><span class="info-label">Exclude :</span> Synonymous, VAF &lt;3%, total depth &lt;100,
                                refer
                                depth=0</p>
                        </div>
                    </div>

                    <!-- DNA, RNA -->
                    <div class="section">
                        <h2 class="section-title">â–£ DNA, RNA <span class="small-text">(Qubit ë†ë„)</span></h2>
                        <div class="info-section">
                            <p><span class="info-label">DNA (ng/ul) :</span> {{ report_data.drna_qubit.DNA }}
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <span class="info-label">RNA (ng/ul) :</span> {{ report_data.drna_qubit.RNA }}
                            </p>
                        </div>
                    </div>

                    <!-- Q.C -->
                    <div class="section">
                        <h2 class="section-title">â–£ Q.C</h2>
                        <div class="info-section">
                            <div class="qc-simple">
                                <div class="qc-header">
                                    <span class="qc-col-tight">Metric (UOM)</span>
                                    <span class="qc-col-tight">LSL Guideline</span>
                                    <span class="qc-col-tight">Value</span>
                                </div>
                                {% if report_data.qc.data %}
                                {% for row in report_data.qc.data %}
                                <div class="qc-row-simple">
                                    <span class="qc-col-tight">{{ row[0] }}</span>
                                    <span class="qc-col-tight">{{ row[1] }}</span>
                                    <span class="qc-col-tight">{{ row[2] }}</span>
                                </div>
                                {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Analysis Program -->
                    <div class="section">
                        <h2 class="section-title">â–£ Analysis Program</h2>
                        <div class="info-section">
                            <p>DRAGEN TSO500 ( Workflow Version : 2.5.2 )</p>
                        </div>
                    </div>

                    <!-- Specification -->
                    <div class="section">
                        <h2 class="section-title">â–£ Specification</h2>
                        <div class="specification-box" id="specification-content">
                            <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page 3: Gene Content -->
        {% if report_data.panel_type == 'GE' %}
        <!-- GE: í•œ í˜ì´ì§€ì— Gene Content + Footer -->
        <div class="a4-page page-3">
            <div class="page-border">
                <div class="page-3-content">
                    <div class="gene-content-wrapper">
                        <div class="section">
                            <h2 class="section-title">â–£ Gene Content in the TruSight Oncology 500 panel Assay</h2>
                            <div class="gene-content-box" id="ge-gene-content">
                                <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
                            </div>
                        </div>
                    </div>

                    <!-- ë§ˆì§€ë§‰ í˜ì´ì§€: ì‚¬ìš©ì ì •ë³´ + Footer -->
                    <div class="page-footer-wrapper">
                        <!-- ì‚¬ìš©ì ì •ë³´ (ë§ˆì§€ë§‰ í˜ì´ì§€ì—ë§Œ) -->
                        <div class="user-info-section">
                            <div class="user-info-divider"></div>
                            <div class="user-info-container">
                                <div class="user-info-number-row">
                                    <table class="user-number-table">
                                        <tr>
                                            <td class="user-number-label">ë¶„ì ì ‘ìˆ˜ ë²ˆí˜¸</td>
                                            <td class="user-number-value">{{ report_data.diagnosis_user['ë¶„ìì ‘ìˆ˜ë²ˆí˜¸'] }}
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="user-info-tested-row">
                                    <span class="user-tested"><strong>Tested by:</strong> {{
                                        report_data.diagnosis_user['Tested by'] }}</span>
                                    <span class="user-analyzed"><strong>Analyzed by:</strong> {{
                                        report_data.diagnosis_user['Analyzed by'] }}</span>
                                </div>
                                <div class="user-info-signed-row">
                                    <span class="user-signed"><strong>Signed by:</strong> {{
                                        report_data.diagnosis_user['Signed by'] }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Footer (ë¡œê³ ì™€ ê²€ì‚¬ê¸°ê´€ ì •ë³´ë§Œ) -->
                        <div class="report-footer">
                            <div class="footer-container">
                                <div class="footer-row">
                                    <div class="footer-left">
                                        <div class="footer-org">ê²€ì‚¬ê¸°ê´€ : ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ ë¶„ìë³‘ë¦¬ ê²€ì‚¬ì‹¤</div>
                                        <div class="footer-address">ì„œìš¸ì‹œ ì„œëŒ€ë¬¸êµ¬ ì—°ì„¸ë¡œ 50-1 (ì‹ ì´Œë™ 134) ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ Tel:
                                            02-2228-2625
                                        </div>
                                    </div>
                                    <div class="footer-right">
                                        <img src="/static/images/Sev_Logo.png" alt="ì„¸ë¸Œë€ìŠ¤ë³‘ì›">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <!-- SA: DNA í˜ì´ì§€ -->
        <div class="a4-page page-3">
            <div class="page-border">
                <div class="page-3-content">
                    <div class="gene-content-wrapper" style="margin-top: 15px;">
                        <div class="section">
                            <h2 class="section-title">â–£ Gene Content in the NGS Sarcoma Panel Assay [DNA]</h2>
                            <div class="gene-content-box" id="sa-gene-content-dna">
                                <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SA: RNA í˜ì´ì§€ + Footer -->
        <div class="a4-page page-4">
            <div class="page-border">
                <div class="page-4-content">
                    <div class="gene-content-wrapper" style="margin-top: 15px;">
                        <div class="section">
                            <h2 class="section-title">â–£ Gene Content in the NGS Sarcoma Panel Assay [RNA]</h2>
                            <div class="gene-content-box" id="sa-gene-content-rna">
                                <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
                            </div>
                        </div>
                    </div>

                    <!-- ë§ˆì§€ë§‰ í˜ì´ì§€: ì‚¬ìš©ì ì •ë³´ + Footer -->
                    <div class="page-footer-wrapper">
                        <!-- ì‚¬ìš©ì ì •ë³´ (ë§ˆì§€ë§‰ í˜ì´ì§€ì—ë§Œ) -->
                        <div class="user-info-section">
                            <div class="user-info-divider"></div>
                            <div class="user-info-container">
                                <div class="user-info-number-row">
                                    <table class="user-number-table">
                                        <tr>
                                            <td class="user-number-label">ë¶„ì ì ‘ìˆ˜ ë²ˆí˜¸</td>
                                            <td class="user-number-value">{{ report_data.diagnosis_user['ë¶„ìì ‘ìˆ˜ë²ˆí˜¸'] }}
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="user-info-tested-row">
                                    <span class="user-tested"><strong>Tested by:</strong> {{
                                        report_data.diagnosis_user['Tested by'] }}</span>
                                    <span class="user-analyzed"><strong>Analyzed by:</strong> {{
                                        report_data.diagnosis_user['Analyzed by'] }}</span>
                                </div>
                                <div class="user-info-signed-row">
                                    <span class="user-signed"><strong>Signed by:</strong> {{
                                        report_data.diagnosis_user['Signed by'] }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Footer (ë¡œê³ ì™€ ê²€ì‚¬ê¸°ê´€ ì •ë³´ë§Œ) -->
                        <div class="report-footer">
                            <div class="footer-container">
                                <div class="footer-row">
                                    <div class="footer-left">
                                        <div class="footer-org">ê²€ì‚¬ê¸°ê´€ : ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ ë¶„ìë³‘ë¦¬ ê²€ì‚¬ì‹¤</div>
                                        <div class="footer-address">ì„œìš¸ì‹œ ì„œëŒ€ë¬¸êµ¬ ì—°ì„¸ë¡œ 50-1 (ì‹ ì´Œë™ 134) ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ Tel:
                                            02-2228-2625
                                        </div>
                                    </div>
                                    <div class="footer-right">
                                        <img src="/static/images/Sev_Logo.png" alt="ì„¸ë¸Œë€ìŠ¤ë³‘ì›">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- ë¶„í• ëœ CNV í…Œì´ë¸”ì„ ìœ„í•œ ì¶”ê°€ í˜ì´ì§€ (í•„ìš”ì‹œ ë™ì  ìƒì„±) -->
    <div class="a4-page page-cnv-continued" id="cnv-continued-page" style="display: none;">
        <div class="page-border">
            <div class="report-content">
                <!-- CNV ë¶„í•  í…Œì´ë¸” (2/2) -->
                <div id="cnv-continued-section">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                </div>
            </div>

            <!-- ì²« í˜ì´ì§€ í•˜ë‹¨ ê³ ì • ì»¨í…ì¸  ë³µì‚¬ -->
            <div class="page-bottom-fixed">
                <!-- Other Biomarkers -->
                <div class="section">
                    <h4 class="variant-type">- Other Biomarkers</h4>
                    <table class="biomarkers-table full-width">
                        <tr>
                            <th>Estimated Tumor Mutation Burden (TMB)</th>
                            <th>Microsatellite Instability (MSI) (% Unstable MSI Sites)</th>
                        </tr>
                        <tr>
                            <td>{{ report_data.biomarkers.TMB }}</td>
                            <td>{{ report_data.biomarkers.MSI }}</td>
                        </tr>
                    </table>
                </div>

                <!-- Footer (ë¡œê³ ì™€ ê²€ì‚¬ê¸°ê´€ ì •ë³´ë§Œ) -->
                <div class="report-footer">
                    <div class="footer-container">
                        <div class="footer-row">
                            <div class="footer-left">
                                <div class="footer-org">ê²€ì‚¬ê¸°ê´€ : ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ ë¶„ìë³‘ë¦¬ ê²€ì‚¬ì‹¤</div>
                                <div class="footer-address">ì„œìš¸ì‹œ ì„œëŒ€ë¬¸êµ¬ ì—°ì„¸ë¡œ 50-1 (ì‹ ì´Œë™ 134) ì„¸ë¸Œë€ìŠ¤ë³‘ì› ë³‘ë¦¬ê³¼ Tel: 02-2228-2625
                                </div>
                            </div>
                            <div class="footer-right">
                                <img src="/static/images/Sev_Logo.png" alt="ì„¸ë¸Œë€ìŠ¤ë³‘ì›">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ê²€ì²´ IDì™€ íŒ¨ë„ íƒ€ì…ì„ JavaScriptë¡œ ì „ë‹¬
        window.specimenId = '{{ specimen_id }}';
        window.panelType = '{{ report_data.panel_type }}';

        // Specification ë™ì  ë¡œë“œ
        async function loadSpecification() {
            const specContainer = document.getElementById('specification-content');
            if (!specContainer || !window.panelType) return;

            try {
                const response = await fetch(`/api/specification/${window.panelType}?t=${Date.now()}`);
                if (response.ok) {
                    const html = await response.text();
                    specContainer.innerHTML = html;
                } else {
                    specContainer.innerHTML = '<p style="text-align: center; color: #999;">Specification ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } catch (error) {
                console.error('Specification ë¡œë“œ ì˜¤ë¥˜:', error);
                specContainer.innerHTML = '<p style="text-align: center; color: #999;">Specification ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }

        // Gene Content ë™ì  ë¡œë“œ
        async function loadGeneContent() {
            if (!window.panelType) return;

            if (window.panelType === 'GE') {
                await loadGEGeneContent();
            } else if (window.panelType === 'SA') {
                await loadSAGeneContent();
            }
        }

        // GE Gene Content ë¡œë“œ
        async function loadGEGeneContent() {
            const container = document.getElementById('ge-gene-content');
            if (!container) return;

            try {
                const response = await fetch('/api/gene-content/GE_Gene_Content_DRNA');
                if (response.ok) {
                    const html = await response.text();
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<p style="text-align: center; color: #999;">Gene Content ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } catch (error) {
                console.error('GE Gene Content ë¡œë“œ ì˜¤ë¥˜:', error);
                container.innerHTML = '<p style="text-align: center; color: #999;">Gene Content ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }

        // SA Gene Content ë¡œë“œ
        async function loadSAGeneContent() {
            const dnaContainer = document.getElementById('sa-gene-content-dna');
            const rnaContainer = document.getElementById('sa-gene-content-rna');

            // DNA Content ë¡œë“œ
            if (dnaContainer) {
                try {
                    const response = await fetch('/api/gene-content/SA_Gene_Content_DNA');
                    if (response.ok) {
                        const html = await response.text();
                        dnaContainer.innerHTML = html;
                    } else {
                        dnaContainer.innerHTML = '<p style="text-align: center; color: #999;">DNA Gene Content ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }
                } catch (error) {
                    console.error('SA DNA Gene Content ë¡œë“œ ì˜¤ë¥˜:', error);
                    dnaContainer.innerHTML = '<p style="text-align: center; color: #999;">DNA Gene Content ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
                }
            }

            // RNA Content ë¡œë“œ
            if (rnaContainer) {
                try {
                    const response = await fetch('/api/gene-content/SA_Gene_Content_RNA');
                    if (response.ok) {
                        const html = await response.text();
                        rnaContainer.innerHTML = html;
                    } else {
                        rnaContainer.innerHTML = '<p style="text-align: center; color: #999;">RNA Gene Content ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }
                } catch (error) {
                    console.error('SA RNA Gene Content ë¡œë“œ ì˜¤ë¥˜:', error);
                    rnaContainer.innerHTML = '<p style="text-align: center; color: #999;">RNA Gene Content ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
                }
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ Specificationê³¼ Gene Content ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function () {
            loadSpecification();
            loadGeneContent();
        });

        // ì •í™•í•œ DOM ìˆœì„œ ê¸°ë°˜ ì½˜í…ì¸  ë°°ì¹˜ ë° ë¶„í•  - ê³µê°„ ìµœëŒ€ í™œìš© ê°œì„ íŒ (ì œëª© ì²˜ë¦¬ í¬í•¨)
        function checkAndSplitTables() {
            console.log('=== STARTING TABLE SPLIT CHECK ===');

            const page1 = document.querySelector('.page-1');
            if (!page1) {
                console.log('Page 1 not found');
                return;
            }

            const bottomFixed = page1.querySelector('.page-bottom-fixed');
            if (!bottomFixed) {
                console.log('Bottom fixed not found');
                return;
            }

            // ëª¨ë“  splittable-section ì°¾ê¸°
            const splittableSections = document.querySelectorAll('.splittable-section');

            splittableSections.forEach((section, index) => {
                const table = section.querySelector('table');
                if (!table) return;

                const thead = table.querySelector('thead');
                const tbody = table.querySelector('tbody');
                const rows = tbody ? tbody.querySelectorAll('tr') : [];

                if (rows.length === 0) return;

                console.log(`Checking section ${index}: ${section.dataset.sectionName}, rows: ${rows.length}`);

                // data-split-at ì†ì„± í™•ì¸ (ë°±ì—”ë“œì—ì„œ ì„¤ì •í•œ ë¶„í•  ì§€ì )
                const splitAtAttr = section.dataset.splitAt;
                if (splitAtAttr) {
                    const splitAt = parseInt(splitAtAttr);
                    console.log(`Using data-split-at value: ${splitAt}`);

                    // ë°±ì—”ë“œì—ì„œ ì§€ì •í•œ ë¶„í•  ì§€ì ì´ ìˆê³ , ë°ì´í„°ê°€ ê·¸ë³´ë‹¤ ë§ìœ¼ë©´ ë¶„í• 
                    if (rows.length > splitAt) {
                        console.log(`Splitting table at row ${splitAt} based on data-split-at`);
                        splitTableAtRow(section, splitAt);
                        return; // ë‹¤ìŒ ì„¹ì…˜ìœ¼ë¡œ
                    }
                }

                // data-split-atì´ ì—†ê±°ë‚˜ ì ìš©ë˜ì§€ ì•Šì€ ê²½ìš°, ê¸°ì¡´ì²˜ëŸ¼ ë™ì  ê³„ì‚°
                // í…Œì´ë¸”ì˜ í˜„ì¬ ìœ„ì¹˜ì™€ í•˜ë‹¨ ê³ ì • ìš”ì†Œ ìœ„ì¹˜ í™•ì¸
                const sectionRect = section.getBoundingClientRect();
                const bottomFixedRect = bottomFixed.getBoundingClientRect();

                // í…Œì´ë¸”ì´ í˜ì´ì§€ í•˜ë‹¨ì„ ì´ˆê³¼í•˜ëŠ”ì§€ ì²´í¬
                if (sectionRect.bottom > bottomFixedRect.top - 5) { // ì•ˆì „ ì—¬ë°± ìµœì†Œí™” (20px â†’ 5px)
                    console.log(`Table ${section.dataset.sectionName} exceeds page bounds`);

                    // ì œëª© ì²´í¬
                    const title = section.querySelector('.variant-type, h4');
                    const titleHeight = title ? title.offsetHeight : 0;
                    const titleRect = title ? title.getBoundingClientRect() : null;

                    // ì œëª©ì´ í˜ì´ì§€ ê²½ê³„ì— ê±¸ì¹˜ëŠ” ê²½ìš°
                    if (titleRect && titleRect.bottom > bottomFixedRect.top - 5) {
                        console.log(`ğŸ“‹ ì œëª©ì´ í˜ì´ì§€ ê²½ê³„ì— ê±¸ì¹¨: ${title.textContent}`);
                        // ì œëª©ì´ ê±¸ì¹˜ëŠ” ê²½ìš° ì „ì²´ ì„¹ì…˜ì„ ë‹¤ìŒ í˜ì´ì§€ë¡œ
                        moveFullSectionToNextPage(section);
                        return; // ë‹¤ìŒ ì„¹ì…˜ìœ¼ë¡œ
                    }

                    // í…Œì´ë¸” ë¶„í•  ì²˜ë¦¬
                    const headerHeight = thead ? thead.offsetHeight : 0;
                    const tableTop = sectionRect.top;
                    const availableSpace = bottomFixedRect.top - tableTop - 3; // ì•ˆì „ ì—¬ë°± ìµœì†Œí™” (20px â†’ 3px)

                    console.log(`Available space: ${availableSpace}px`);
                    console.log(`Title height: ${titleHeight}px`);
                    console.log(`Header height: ${headerHeight}px`);

                    // ì œëª©ê³¼ í—¤ë”ë¥¼ ì œì™¸í•œ ì‹¤ì œ ë°ì´í„° ì˜ì—­
                    let usedHeight = titleHeight + headerHeight;
                    let splitPoint = 0;

                    // ê° í–‰ì˜ ë†’ì´ë¥¼ ì¸¡ì •í•˜ì—¬ ë“¤ì–´ê°ˆ ìˆ˜ ìˆëŠ” ìµœëŒ€ í–‰ ìˆ˜ ì°¾ê¸°
                    for (let i = 0; i < rows.length; i++) {
                        const rowHeight = rows[i].offsetHeight;
                        console.log(`Row ${i} height: ${rowHeight}px, used: ${usedHeight}px, available: ${availableSpace}px`);

                        if (usedHeight + rowHeight <= availableSpace) {
                            usedHeight += rowHeight;
                            splitPoint = i + 1; // ì´ í–‰ê¹Œì§€ëŠ” ë“¤ì–´ê°ˆ ìˆ˜ ìˆìŒ
                        } else {
                            break; // ë” ì´ìƒ ë“¤ì–´ê°ˆ ìˆ˜ ì—†ìŒ
                        }
                    }

                    console.log(`Can fit ${splitPoint} rows out of ${rows.length} in available space`);

                    // ê°€ëŠ¥í•œ í•œ ìµœëŒ€í•œ ë§ì€ í–‰ì„ ì²« í˜ì´ì§€ì— ë„£ê¸°
                    if (splitPoint === 0 && rows.length > 0) {
                        // ì „ì²´ ì„¹ì…˜ì„ ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™
                        console.log(`Cannot fit any rows, moving entire section`);
                        moveFullSectionToNextPage(section);
                    } else if (splitPoint > 0 && splitPoint < rows.length) {
                        // ê°€ëŠ¥í•œ í•œ ë§ì€ í–‰ì„ ì²« í˜ì´ì§€ì— ë‚¨ê¸°ê³  ë¶„í• 
                        console.log(`Splitting at row ${splitPoint} to maximize space usage`);
                        splitTableAtRow(section, splitPoint);
                    }
                    // splitPoint === rows.lengthì¸ ê²½ìš°ëŠ” ëª¨ë“  í–‰ì´ ë“¤ì–´ê°€ë¯€ë¡œ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
                }
            });

            console.log('=== TABLE SPLIT CHECK COMPLETE ===');
        }

        // í…Œì´ë¸”ì„ íŠ¹ì • í–‰ì—ì„œ ë¶„í• 
        function splitTableAtRow(section, splitPoint) {
            const sectionName = section.dataset.sectionName;
            const tableType = section.dataset.tableType || '';
            const table = section.querySelector('table');
            const tbody = table.querySelector('tbody');
            const rows = tbody.querySelectorAll('tr');

            // ì œëª©ì— (1/2) ì¶”ê°€
            const title = section.querySelector('.variant-type');
            if (title && !title.textContent.includes('(1/2)')) {
                title.innerHTML = title.innerHTML.replace(`- ${sectionName}`, `- ${sectionName} (1/2)`);
            }

            // ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™í•  í–‰ë“¤ ìˆ˜ì§‘
            const rowsToMove = [];
            for (let i = splitPoint; i < rows.length; i++) {
                rowsToMove.push(rows[i].cloneNode(true));
            }

            // ì›ë³¸ì—ì„œ ì´ˆê³¼ í–‰ ì œê±°
            for (let i = rows.length - 1; i >= splitPoint; i--) {
                rows[i].remove();
            }

            // ë‹¤ìŒ í˜ì´ì§€ ìƒì„± ë˜ëŠ” ì°¾ê¸°
            let nextPage = document.querySelector('.page-content-continued');
            if (!nextPage) {
                nextPage = createContinuedPage();
            }

            // ë¶„í• ëœ í…Œì´ë¸” ìƒì„±
            const newSection = createSplitSection(section, rowsToMove, sectionName, tableType);
            const nextContent = nextPage.querySelector('.report-content');
            nextContent.appendChild(newSection);
        }

        // ì „ì²´ ì„¹ì…˜ì„ ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™
        function moveFullSectionToNextPage(section) {
            let nextPage = document.querySelector('.page-content-continued');
            if (!nextPage) {
                nextPage = createContinuedPage();
            }

            const nextContent = nextPage.querySelector('.report-content');
            nextContent.appendChild(section);
        }

        // ì—°ì† í˜ì´ì§€ ìƒì„±
        function createContinuedPage() {
            const page1 = document.querySelector('.page-1');
            const newPage = document.createElement('div');
            newPage.className = 'a4-page page-content-continued';
            newPage.innerHTML = `
                <div class="page-border">
                    <div class="report-content"></div>
                </div>
            `;
            page1.parentNode.insertBefore(newPage, page1.nextSibling);
            return newPage;
        }

        // ë¶„í• ëœ ì„¹ì…˜ ìƒì„±
        function createSplitSection(originalSection, rowsToMove, sectionName, tableType) {
            const newSection = document.createElement('div');
            newSection.className = 'continued-section';

            // ì›ë³¸ ì œëª©ì˜ í´ë˜ìŠ¤ì™€ í•˜ì´ë¼ì´íŠ¸ ë³µì‚¬
            const originalTitle = originalSection.querySelector('.variant-type');
            const highlight = originalTitle ? originalTitle.querySelector('.clinical-highlight') : null;
            const highlightHTML = highlight ? highlight.outerHTML : '';
            const titleClasses = originalTitle ? originalTitle.className : 'variant-type';

            // í…Œì´ë¸” í—¤ë” ë³µì‚¬
            const originalTable = originalSection.querySelector('table');
            const originalHeader = originalTable.querySelector('thead').cloneNode(true);

            // ìƒˆ í…Œì´ë¸” ìƒì„±
            const newTable = document.createElement('table');
            newTable.className = originalTable.className + ' split-table-continued';
            newTable.setAttribute('border', '1');

            const newTbody = document.createElement('tbody');
            rowsToMove.forEach(row => newTbody.appendChild(row));

            newTable.appendChild(originalHeader);
            newTable.appendChild(newTbody);

            // ìƒˆ ì„¹ì…˜ êµ¬ì„±
            newSection.innerHTML = `
                <h4 class="${titleClasses}">- ${sectionName} (2/2)${highlightHTML}</h4>
            `;
            newSection.appendChild(newTable);

            return newSection;
        }

        // ê¸°ì¡´ í•¨ìˆ˜ë“¤ ì œê±° (ìƒˆ ë¡œì§ìœ¼ë¡œ ëŒ€ì²´)

        // í˜ì´ì§€ ë¡œë“œ í›„ í…Œì´ë¸” ë¶„í•  ì²´í¬ - ê°„ë‹¨í•˜ê²Œ
        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM Content Loaded');

            /* 
             Legacy code removed to prevent conflict with script.js dynamicClinicalPagination
            setTimeout(() => {
                console.log('Final check after 1500ms');
                checkAndSplitTables();
            }, 1500);
            */
        });

        /*
        // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì‹œì—ë„ ì²´í¬
        window.addEventListener('resize', function () {
            console.log('Window resized');
            setTimeout(() => {
                checkAndSplitTables();
            }, 500);
        });

        // ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ í›„ì—ë„ ì²´í¬
        window.addEventListener('load', function () {
            console.log('Window fully loaded (including images)');
            setTimeout(() => {
                console.log('Final check after full load');
                checkAndSplitTables();
            }, 2000);
        });
        
        function checkAndSplitTables() {
             // Disabled
        }
        */
    </script>
    <script src="/static/js/script.js?v=18.12"></script>

    <!-- PDF ë‹¤ìš´ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸ -->
    <!-- <script src="/static/js/report.js"></script> -->
</body>

</html>